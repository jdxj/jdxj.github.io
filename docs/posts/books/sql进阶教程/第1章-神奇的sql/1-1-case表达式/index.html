<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>1-1 CASE表达式 | jdxj</title>
<meta name=keywords content><meta name=description content="CASE表达式概述 CASE表达式的写法 1 2 3 4 5 6 7 8 9 10 --简单CASE表达式 CASE sex WHEN '1' THEN ’男’ WHEN '2' THEN ’女’ ELSE ’其他’ END --搜索CASE表达"><meta name=author content><link rel=canonical href=https://jdxj.github.io/posts/books/sql%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/%E7%AC%AC1%E7%AB%A0-%E7%A5%9E%E5%A5%87%E7%9A%84sql/1-1-case%E8%A1%A8%E8%BE%BE%E5%BC%8F/><link crossorigin=anonymous href=/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U+6hYRq/Ez/nm5vg=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://jdxj.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://jdxj.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://jdxj.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://jdxj.github.io/apple-touch-icon.png><link rel=mask-icon href=https://jdxj.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-FBE4H074FW"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-FBE4H074FW",{anonymize_ip:!1})}</script><meta property="og:title" content="1-1 CASE表达式"><meta property="og:description" content="CASE表达式概述 CASE表达式的写法 1 2 3 4 5 6 7 8 9 10 --简单CASE表达式 CASE sex WHEN '1' THEN ’男’ WHEN '2' THEN ’女’ ELSE ’其他’ END --搜索CASE表达"><meta property="og:type" content="article"><meta property="og:url" content="https://jdxj.github.io/posts/books/sql%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/%E7%AC%AC1%E7%AB%A0-%E7%A5%9E%E5%A5%87%E7%9A%84sql/1-1-case%E8%A1%A8%E8%BE%BE%E5%BC%8F/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-25T16:27:54+08:00"><meta property="article:modified_time" content="2023-03-20T22:12:19+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="1-1 CASE表达式"><meta name=twitter:description content="CASE表达式概述 CASE表达式的写法 1 2 3 4 5 6 7 8 9 10 --简单CASE表达式 CASE sex WHEN '1' THEN ’男’ WHEN '2' THEN ’女’ ELSE ’其他’ END --搜索CASE表达"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://jdxj.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Books","item":"https://jdxj.github.io/posts/books/"},{"@type":"ListItem","position":6,"name":"1-1 CASE表达式","item":"https://jdxj.github.io/posts/books/sql%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/%E7%AC%AC1%E7%AB%A0-%E7%A5%9E%E5%A5%87%E7%9A%84sql/1-1-case%E8%A1%A8%E8%BE%BE%E5%BC%8F/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"1-1 CASE表达式","name":"1-1 CASE表达式","description":"CASE表达式概述 CASE表达式的写法 1 2 3 4 5 6 7 8 9 10 --简单CASE表达式 CASE sex WHEN \u0026#39;1\u0026#39; THEN ’男’ WHEN \u0026#39;2\u0026#39; THEN ’女’ ELSE ’其他’ END --搜索CASE表达","keywords":[],"articleBody":"CASE表达式概述 CASE表达式的写法\n1 2 3 4 5 6 7 8 9 10 --简单CASE表达式 CASE sex WHEN '1' THEN ’男’ WHEN '2' THEN ’女’ ELSE ’其他’ END --搜索CASE表达式 CASE WHEN sex ='1'THEN’男’ WHEN sex ='2'THEN’女’ ELSE ’其他’ END 剩余的WHEN子句被忽略的写法示例\n1 2 3 4 --例如，这样写的话，结果里不会出现“第二” CASE WHEN col_1 IN ('a', 'b') THEN’第一’ WHEN col_1 IN ('a') THEN’第二’ ELSE ’其他’ END 注意\n注意事项1：各分支返回的数据类型要一致, 否则报错 注意事项2：不要忘了写END 注意事项3：养成写ELSE子句的习惯 不写可能会造成“语法没有错误，结果却不对”这种不易追查原因的麻烦 养成这样的习惯后，我们从代码上就可以清楚地看到这种条件下会生成NULL，而且将来代码有修改时也能减少失误。 将已有编号方式转换为新的方式并统计 统计数据源表PopTbl\n统计结果\n用县名（pref_name）代替编号作为GROUP BY的列\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 --把县编号转换成地区编号(1) SELECT CASE pref_name WHEN ’德岛’ THEN ’四国’ WHEN ’香川’ THEN ’四国’ WHEN ’爱媛’ THEN ’四国’ WHEN ’高知’ THEN ’四国’ WHEN ’福冈’ THEN ’九州’ WHEN ’佐贺’ THEN ’九州’ WHEN ’长崎’ THEN ’九州’ ELSE’其他’END AS district, SUM(population) FROM PopTbl GROUP BY CASE pref_name WHEN ’德岛’ THEN ’四国’ WHEN ’香川’ THEN ’四国’ WHEN ’爱媛’ THEN ’四国’ WHEN ’高知’ THEN ’四国’ WHEN ’福冈’ THEN ’九州’ WHEN ’佐贺’ THEN ’九州’ WHEN ’长崎’ THEN ’九州’ ELSE ’其他’ END; 将数值按照适当的级别进行分类统计\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 --按人口数量等级划分都道府县 SELECT CASE WHEN population \u003c 100 THEN'01' WHEN population \u003e= 100 AND population \u003c 200 THEN'02' WHEN population \u003e= 200 AND population \u003c 300 THEN'03' WHEN population \u003e= 300 THEN'04' ELSE NULL END AS pop_class, COUNT(＊) AS cnt FROM PopTbl GROUP BY CASE WHEN population \u003c 100 THEN'01' WHEN population \u003e= 100 AND population \u003c 200 THEN'02' WHEN population \u003e= 200 AND population \u003c 300 THEN'03' WHEN population \u003e= 300 THEN'04' ELSE NULL END; pop_class cnt --------- ---- 01 1 02 3 03 3 04 2 上面两种方式都要在select和group by中写相同的case, 在变更时可能会忘记同步, 下面的写法更方便\n严格来说，这种写法是违反标准SQL的规则的。因为GROUP BY子句比SELECT语句先执行，所以在GROUP BY子句中引用在SELECT子句里定义的别称是不被允 许的。事实上，在Oracle、DB2、SQL Server等数据库里采用这种写法时就会出错。 不过也有支持这种SQL语句的数据库，例如在PostgreSQL和MySQL中，这个查询语句就可以顺利执行。这是因为，这些数据库在执行查询语句时，会先对 SELECT子句里的列表进行扫描，并对列进行计算。 用一条SQL语句进行不同条件的统计 统计源表PopTbl2\n统计结果\n通常的做法是写两个sql, 可能然后再用union合并\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 -- 男性人口 SELECT pref_name, SUM(population) FROM PopTbl2 WHERE sex ='1' GROUP BY pref_name; -- 女性人口 SELECT pref_name, SUM(population) FROM PopTbl2 WHERE sex ='2' GROUP BY pref_name; 用一条sql实现\n1 2 3 4 5 6 7 SELECT pref_name, --男性人口 SUM( CASE WHEN sex ='1'THEN population ELSE 0 END) AS cnt_m, --女性人口 SUM( CASE WHEN sex ='2'THEN population ELSE 0 END) AS cnt_f FROM PopTbl2 GROUP BY pref_name; 用CHECK约束定义多个列的条件关系 假设某公司规定“女性员工的工资必须在20万日元以下”，而在这个公司的人事表中，这条无理的规定是使用CHECK约束来描述的\n1 2 3 4 5 6 7 8 9 CONSTRAINT check_salary CHECK ( CASE WHEN sex ='2' THEN CASE WHEN salary \u003c= 200000 THEN 1 ELSE 0 END ELSE 1 END = 1 ) 用逻辑与改写的CHECK约束如下所示。\n1 2 CONSTRAINT check_salary CHECK ( sex ='2'AND salary \u003c= 200000 ) 这两个约束的程序行为不一样(第二个如果是男雇员也返回false了, 不符合命题)\n逻辑与和蕴含式的真值表\nU表示unknown 在UPDATE语句里进行条件分支 Salaries\n假设现在需要根据以下条件对该表的数据进行更新。\n对当前工资为30万日元以上的员工，降薪10%。 对当前工资为25万日元以上且不满28万日元的员工，加薪20%。 按照这些要求更新完的数据应该如下表所示。\n乍一看，分别执行下面两个UPDATE操作好像就可以做到，但这样的结果却是不正确的。\n1 2 3 4 5 6 7 8 9 --条件1 UPDATE Salaries SET salary = salary ＊ 0.9 WHERE salary \u003e= 300000; --条件2 UPDATE Salaries SET salary = salary ＊ 1.2 WHERE salary \u003e= 250000 AND salary \u003c 280000; 正确的写法\n注意最后的else必须写, 否则返回null 1 2 3 4 5 6 7 --用CASE表达式写正确的更新操作 UPDATE Salaries SET salary = CASE WHEN salary \u003e= 300000 THEN salary ＊ 0.9 WHEN salary \u003e= 250000 AND salary \u003c 280000 THEN salary ＊ 1.2 ELSE salary END; 调换主键值的方便写法\nSomeTable\n不使用case\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 --1．将a转换为中间值d UPDATE SomeTable SET p_key ='d' WHERE p_key ='a'; --2．将b调换为a UPDATE SomeTable SET p_key ='a' WHERE p_key ='b'; --3．将d调换为b UPDATE SomeTable SET p_key ='b' WHERE p_key ='d'; 使用case\n适用于Oracle, DB2, SQL Server 不适用于PostgreSQL, MySQWL 1 2 3 4 5 6 7 8 --用CASE表达式调换主键值 UPDATE SomeTable SET p_key = CASE WHEN p_key ='a' THEN 'b' WHEN p_key ='b' THEN 'a' ELSE p_key END WHERE p_key IN ('a', 'b'); 表之间的数据匹配 课程一览 CourseMaster\n开设的课程 OpenCourses\n我们要用这两张表来生成下面这样的交叉表\ncourse_name 6月 7月 8月 ----------- ---- ---- ---- 会计入门 ○ × × 财务知识 × × ○ 簿记考试 ○ × × 税务师 ○ ○ ○ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 --表的匹配：使用IN谓词 SELECT course_name, CASE WHEN course_id IN (SELECT course_id FROM OpenCourses WHERE month = 200706) THEN'○' ELSE'×'END AS \"6月\", CASE WHEN course_id IN (SELECT course_id FROM OpenCourses WHERE month = 200707) THEN'○' ELSE'×'END AS \"7月\", CASE WHEN course_id IN (SELECT course_id FROM OpenCourses WHERE month = 200708) THEN'○' ELSE'×'END AS \"8月\" FROM CourseMaster; --表的匹配：使用EXISTS谓词 SELECT CM.course_name, CASE WHEN EXISTS (SELECT course_id FROM OpenCourses OC WHERE month = 200706 AND OC.course_id = CM.course_id) THEN'○' ELSE'×'END AS \"6月\", CASE WHEN EXISTS (SELECT course_id FROM OpenCourses OC WHERE month = 200707 AND OC.course_id = CM.course_id) THEN'○' ELSE'×'END AS \"7月\", CASE WHEN EXISTS (SELECT course_id FROM OpenCourses OC WHERE month = 200708 AND OC.course_id = CM.course_id) THEN'○' ELSE'×'END AS \"8月\" FROM CourseMaster CM; 无论使用IN还是EXISTS，得到的结果是一样的，但从性能方面来说，EXISTS更好。通过EXISTS进行的子查询能够用到“month, course_id”这样的主键索引， 因此尤其是当表OpenCourses里数据比较多的时候更有优势。\n在CASE表达式中使用聚合函数 假设这里有一张显示了学生及其加入的社团的一览表。如表StudentClub所示，这张表的主键是“学号、社团ID”，存储了学生和社团之间多对多的关系。\nStudentClub\n我们按照下面的条件查询这张表里的数据。\n获取只加入了一个社团的学生的社团ID。 获取加入了多个社团的学生的主社团ID。 条件1的SQL\n1 2 3 4 5 --条件1：选择只加入了一个社团的学生 SELECT std_id, MAX(club_id) AS main_club FROM StudentClub GROUP BY std_id HAVING COUNT(＊) = 1; 执行结果1\n1 2 3 4 5 std_id main_club ------ ---------- 300 4 400 5 500 6 条件2的SQL\n1 2 3 4 --条件2：选择加入了多个社团的学生 SELECT std_id, club_id AS main_club FROM StudentClub WHERE main_club_flg ='Y'; 执行结果2\n1 2 3 4 std_id main_club ------ ---------- 100 1 200 3 如果使用CASE表达式，下面这一条SQL语句就可以了\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 SELECT std_id, CASE WHEN COUNT(＊) = 1 --只加入了一个社团的学生 THEN MAX(club_id) ELSE MAX(CASE WHEN main_club_flg ='Y' THEN club_id ELSE NULL END) END AS main_club FROM StudentClub GROUP BY std_id; std_id main_club ------ ---------- 100 1 200 3 300 4 400 5 500 6 本节小结 最后说一点细节的东西。CASE表达式经常会因为同VB和C语言里的CASE“语句”混淆而被叫作CASE语句。但是准确来说，它并不是语句，而是和1+1或者a/b一样 属于表达式的范畴。结束符END确实看起来像是在标记一连串处理过程的终结，所以初次接触CASE表达式的人容易对这一点感到困惑。“表达式”和“语句”的名称 区别恰恰反映了两者在功能处理方面的差异。\n作为表达式，CASE表达式在执行时会被判定为一个固定值，因此它可以写在聚合函数内部；也正因为它是表达式，所以还可以写在SELECE子句、GROUP BY 子句、WHERE子句、ORDER BY子句里。简单点说，在能写列名和常量的地方，通常都可以写CASE表达式。从这个意义上来说，与CASE表达式最接近的不是面向 过程语言里的CASE语句，而是Lisp和Scheme等函数式语言里的case和cond这样的条件表达式。\n","wordCount":"3243","inLanguage":"en","datePublished":"2023-02-25T16:27:54+08:00","dateModified":"2023-03-20T22:12:19+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://jdxj.github.io/posts/books/sql%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/%E7%AC%AC1%E7%AB%A0-%E7%A5%9E%E5%A5%87%E7%9A%84sql/1-1-case%E8%A1%A8%E8%BE%BE%E5%BC%8F/"},"publisher":{"@type":"Organization","name":"jdxj","logo":{"@type":"ImageObject","url":"https://jdxj.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://jdxj.github.io accesskey=h title="jdxj (Alt + H)">jdxj</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://jdxj.github.io/archives title=Archives><span>Archives</span></a></li><li><a href=https://jdxj.github.io/posts title=Collections><span>Collections</span></a></li><li><a href=https://jdxj.github.io/search title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://jdxj.github.io/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://jdxj.github.io>Home</a>&nbsp;»&nbsp;<a href=https://jdxj.github.io/posts/>Posts</a>&nbsp;»&nbsp;<a href=https://jdxj.github.io/posts/books/>Books</a>&nbsp;»&nbsp;<a href=https://jdxj.github.io/posts/books/sql%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/>SQL进阶教程</a>&nbsp;»&nbsp;<a href=https://jdxj.github.io/posts/books/sql%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/%E7%AC%AC1%E7%AB%A0-%E7%A5%9E%E5%A5%87%E7%9A%84sql/>第1章 神奇的SQL</a></div><h1 class=post-title>1-1 CASE表达式</h1><div class=post-meta><span title='2023-02-25 16:27:54 +0800 CST'>February 25, 2023</span>&nbsp;·&nbsp;3243 words</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#case%e8%a1%a8%e8%be%be%e5%bc%8f%e6%a6%82%e8%bf%b0 aria-label=CASE表达式概述>CASE表达式概述</a></li><li><a href=#%e5%b0%86%e5%b7%b2%e6%9c%89%e7%bc%96%e5%8f%b7%e6%96%b9%e5%bc%8f%e8%bd%ac%e6%8d%a2%e4%b8%ba%e6%96%b0%e7%9a%84%e6%96%b9%e5%bc%8f%e5%b9%b6%e7%bb%9f%e8%ae%a1 aria-label=将已有编号方式转换为新的方式并统计>将已有编号方式转换为新的方式并统计</a></li><li><a href=#%e7%94%a8%e4%b8%80%e6%9d%a1sql%e8%af%ad%e5%8f%a5%e8%bf%9b%e8%a1%8c%e4%b8%8d%e5%90%8c%e6%9d%a1%e4%bb%b6%e7%9a%84%e7%bb%9f%e8%ae%a1 aria-label=用一条SQL语句进行不同条件的统计>用一条SQL语句进行不同条件的统计</a></li><li><a href=#%e7%94%a8check%e7%ba%a6%e6%9d%9f%e5%ae%9a%e4%b9%89%e5%a4%9a%e4%b8%aa%e5%88%97%e7%9a%84%e6%9d%a1%e4%bb%b6%e5%85%b3%e7%b3%bb aria-label=用CHECK约束定义多个列的条件关系>用CHECK约束定义多个列的条件关系</a></li><li><a href=#%e5%9c%a8update%e8%af%ad%e5%8f%a5%e9%87%8c%e8%bf%9b%e8%a1%8c%e6%9d%a1%e4%bb%b6%e5%88%86%e6%94%af aria-label=在UPDATE语句里进行条件分支>在UPDATE语句里进行条件分支</a></li><li><a href=#%e8%a1%a8%e4%b9%8b%e9%97%b4%e7%9a%84%e6%95%b0%e6%8d%ae%e5%8c%b9%e9%85%8d aria-label=表之间的数据匹配>表之间的数据匹配</a></li><li><a href=#%e5%9c%a8case%e8%a1%a8%e8%be%be%e5%bc%8f%e4%b8%ad%e4%bd%bf%e7%94%a8%e8%81%9a%e5%90%88%e5%87%bd%e6%95%b0 aria-label=在CASE表达式中使用聚合函数>在CASE表达式中使用聚合函数</a></li><li><a href=#%e6%9c%ac%e8%8a%82%e5%b0%8f%e7%bb%93 aria-label=本节小结>本节小结</a></li></ul></div></details></div><div class=post-content><h1 id=case表达式概述>CASE表达式概述<a hidden class=anchor aria-hidden=true href=#case表达式概述>#</a></h1><p>CASE表达式的写法</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#75715e>--简单CASE表达式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>CASE</span> sex
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>WHEN</span> <span style=color:#e6db74>&#39;1&#39;</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’男’</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>WHEN</span> <span style=color:#e6db74>&#39;2&#39;</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’女’</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ELSE</span> <span style=color:#960050;background-color:#1e0010>’其他’</span> <span style=color:#66d9ef>END</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>--搜索CASE表达式
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> sex <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;1&#39;</span><span style=color:#66d9ef>THEN</span><span style=color:#960050;background-color:#1e0010>’男’</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>WHEN</span> sex <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2&#39;</span><span style=color:#66d9ef>THEN</span><span style=color:#960050;background-color:#1e0010>’女’</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ELSE</span> <span style=color:#960050;background-color:#1e0010>’其他’</span> <span style=color:#66d9ef>END</span>
</span></span></code></pre></td></tr></table></div></div><p>剩余的WHEN子句被忽略的写法示例</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#75715e>--例如，这样写的话，结果里不会出现“第二”
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> col_1 <span style=color:#66d9ef>IN</span> (<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>) <span style=color:#66d9ef>THEN</span><span style=color:#960050;background-color:#1e0010>’第一’</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>WHEN</span> col_1 <span style=color:#66d9ef>IN</span> (<span style=color:#e6db74>&#39;a&#39;</span>)     <span style=color:#66d9ef>THEN</span><span style=color:#960050;background-color:#1e0010>’第二’</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>ELSE</span> <span style=color:#960050;background-color:#1e0010>’其他’</span> <span style=color:#66d9ef>END</span>
</span></span></code></pre></td></tr></table></div></div><p>注意</p><ul><li>注意事项1：各分支返回的数据类型要一致, 否则报错</li><li>注意事项2：不要忘了写END</li><li>注意事项3：养成写ELSE子句的习惯<ul><li>不写可能会造成“语法没有错误，结果却不对”这种不易追查原因的麻烦</li><li>养成这样的习惯后，我们从代码上就可以清楚地看到这种条件下会生成NULL，而且将来代码有修改时也能减少失误。</li></ul></li></ul><h1 id=将已有编号方式转换为新的方式并统计>将已有编号方式转换为新的方式并统计<a hidden class=anchor aria-hidden=true href=#将已有编号方式转换为新的方式并统计>#</a></h1><p>统计数据源表PopTbl</p><p><img loading=lazy src=https://res.weread.qq.com/wrepub/epub_26211874_9 alt></p><p>统计结果</p><p><img loading=lazy src=https://res.weread.qq.com/wrepub/epub_26211874_11 alt></p><p>用县名（pref_name）代替编号作为GROUP BY的列</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#75715e>--把县编号转换成地区编号(1)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>SELECT</span>  <span style=color:#66d9ef>CASE</span> pref_name
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’德岛’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’四国’</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’香川’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’四国’</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’爱媛’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’四国’</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’高知’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’四国’</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’福冈’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’九州’</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’佐贺’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’九州’</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’长崎’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’九州’</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>ELSE</span><span style=color:#960050;background-color:#1e0010>’其他’</span><span style=color:#66d9ef>END</span> <span style=color:#66d9ef>AS</span> district,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>SUM</span>(population)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>FROM</span>  PopTbl
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> <span style=color:#66d9ef>CASE</span> pref_name
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’德岛’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’四国’</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’香川’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’四国’</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’爱媛’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’四国’</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’高知’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’四国’</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’福冈’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’九州’</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’佐贺’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’九州’</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> <span style=color:#960050;background-color:#1e0010>’长崎’</span> <span style=color:#66d9ef>THEN</span> <span style=color:#960050;background-color:#1e0010>’九州’</span>
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>ELSE</span> <span style=color:#960050;background-color:#1e0010>’其他’</span> <span style=color:#66d9ef>END</span>;
</span></span></code></pre></td></tr></table></div></div><p>将数值按照适当的级别进行分类统计</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#75715e>--按人口数量等级划分都道府县
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>SELECT</span>  <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> population <span style=color:#f92672>&lt;</span>  <span style=color:#ae81ff>100</span> <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;01&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>WHEN</span> population <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>100</span> <span style=color:#66d9ef>AND</span> population <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>200</span>  <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;02&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>WHEN</span> population <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>200</span> <span style=color:#66d9ef>AND</span> population <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>300</span>  <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;03&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>WHEN</span> population <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>300</span> <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;04&#39;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>ELSE</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>END</span> <span style=color:#66d9ef>AS</span> pop_class,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>COUNT</span>(<span style=color:#960050;background-color:#1e0010>＊</span>) <span style=color:#66d9ef>AS</span> cnt
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>FROM</span>  PopTbl
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> population <span style=color:#f92672>&lt;</span>  <span style=color:#ae81ff>100</span> <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;01&#39;</span>
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>WHEN</span> population <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>100</span> <span style=color:#66d9ef>AND</span> population <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>200</span>  <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;02&#39;</span>
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>WHEN</span> population <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>200</span> <span style=color:#66d9ef>AND</span> population <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>300</span>  <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;03&#39;</span>
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>WHEN</span> population <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>300</span> <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;04&#39;</span>
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>ELSE</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>END</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    pop_class  cnt
</span></span><span style=display:flex><span>    <span style=color:#75715e>--------- ----
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#ae81ff>01</span>            <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>02</span>            <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>03</span>            <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>04</span>            <span style=color:#ae81ff>2</span>
</span></span></code></pre></td></tr></table></div></div><p>上面两种方式都要在select和group by中写相同的case, 在变更时可能会忘记同步, 下面的写法更方便</p><p><img loading=lazy src=https://res.weread.qq.com/wrepub/epub_26211874_12 alt></p><ul><li>严格来说，这种写法是违反标准SQL的规则的。因为GROUP BY子句比SELECT语句先执行，所以在GROUP BY子句中引用在SELECT子句里定义的别称是不被允
许的。事实上，在Oracle、DB2、SQL Server等数据库里采用这种写法时就会出错。</li><li>不过也有支持这种SQL语句的数据库，例如在PostgreSQL和MySQL中，这个查询语句就可以顺利执行。这是因为，这些数据库在执行查询语句时，会先对
SELECT子句里的列表进行扫描，并对列进行计算。</li></ul><h1 id=用一条sql语句进行不同条件的统计>用一条SQL语句进行不同条件的统计<a hidden class=anchor aria-hidden=true href=#用一条sql语句进行不同条件的统计>#</a></h1><p>统计源表PopTbl2</p><p><img loading=lazy src=https://res.weread.qq.com/wrepub/epub_26211874_14 alt></p><p>统计结果</p><p><img loading=lazy src=https://res.weread.qq.com/wrepub/epub_26211874_15 alt></p><p>通常的做法是写两个sql, 可能然后再用union合并</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#75715e>-- 男性人口
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>SELECT</span> pref_name,
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>SUM</span>(population)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>FROM</span> PopTbl2
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>WHERE</span> sex <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;1&#39;</span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> pref_name;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>-- 女性人口
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>SELECT</span> pref_name,
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>SUM</span>(population)
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>FROM</span> PopTbl2
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>WHERE</span> sex <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2&#39;</span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> pref_name;
</span></span></code></pre></td></tr></table></div></div><p>用一条sql实现</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#66d9ef>SELECT</span> pref_name,
</span></span><span style=display:flex><span>          <span style=color:#75715e>--男性人口
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#66d9ef>SUM</span>( <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> sex <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;1&#39;</span><span style=color:#66d9ef>THEN</span> population <span style=color:#66d9ef>ELSE</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>END</span>) <span style=color:#66d9ef>AS</span> cnt_m,
</span></span><span style=display:flex><span>          <span style=color:#75715e>--女性人口
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#66d9ef>SUM</span>( <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> sex <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2&#39;</span><span style=color:#66d9ef>THEN</span> population <span style=color:#66d9ef>ELSE</span> <span style=color:#ae81ff>0</span> <span style=color:#66d9ef>END</span>) <span style=color:#66d9ef>AS</span> cnt_f
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>FROM</span>  PopTbl2
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> pref_name;
</span></span></code></pre></td></tr></table></div></div><h1 id=用check约束定义多个列的条件关系>用CHECK约束定义多个列的条件关系<a hidden class=anchor aria-hidden=true href=#用check约束定义多个列的条件关系>#</a></h1><p>假设某公司规定“女性员工的工资必须在20万日元以下”，而在这个公司的人事表中，这条无理的规定是使用CHECK约束来描述的</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> check_salary <span style=color:#66d9ef>CHECK</span>
</span></span><span style=display:flex><span>              ( <span style=color:#66d9ef>CASE</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>WHEN</span> sex <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2&#39;</span> <span style=color:#66d9ef>THEN</span> 
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>CASE</span>
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>WHEN</span> salary <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>200000</span> <span style=color:#66d9ef>THEN</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>ELSE</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>END</span>
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>ELSE</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>END</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> )
</span></span></code></pre></td></tr></table></div></div><p>用逻辑与改写的CHECK约束如下所示。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#66d9ef>CONSTRAINT</span> check_salary <span style=color:#66d9ef>CHECK</span>
</span></span><span style=display:flex><span>              ( sex <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2&#39;</span><span style=color:#66d9ef>AND</span> salary <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>200000</span> )
</span></span></code></pre></td></tr></table></div></div><p>这两个约束的程序行为不一样(第二个如果是男雇员也返回false了, 不符合命题)</p><p>逻辑与和蕴含式的真值表</p><ul><li>U表示unknown</li></ul><p><img loading=lazy src=https://res.weread.qq.com/wrepub/epub_26211874_17 alt></p><h1 id=在update语句里进行条件分支>在UPDATE语句里进行条件分支<a hidden class=anchor aria-hidden=true href=#在update语句里进行条件分支>#</a></h1><p>Salaries</p><p><img loading=lazy src=https://res.weread.qq.com/wrepub/epub_26211874_19 alt></p><p>假设现在需要根据以下条件对该表的数据进行更新。</p><ol><li>对当前工资为30万日元以上的员工，降薪10%。</li><li>对当前工资为25万日元以上且不满28万日元的员工，加薪20%。</li></ol><p>按照这些要求更新完的数据应该如下表所示。</p><p><img loading=lazy src=https://res.weread.qq.com/wrepub/epub_26211874_20 alt></p><p>乍一看，分别执行下面两个UPDATE操作好像就可以做到，但这样的结果却是不正确的。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#75715e>--条件1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>UPDATE</span> Salaries
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>SET</span> salary <span style=color:#f92672>=</span> salary <span style=color:#960050;background-color:#1e0010>＊</span> <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>WHERE</span> salary <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>300000</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>--条件2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>UPDATE</span> Salaries
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>SET</span> salary <span style=color:#f92672>=</span> salary <span style=color:#960050;background-color:#1e0010>＊</span> <span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>WHERE</span> salary <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>250000</span> <span style=color:#66d9ef>AND</span> salary <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>280000</span>;
</span></span></code></pre></td></tr></table></div></div><p>正确的写法</p><ul><li>注意最后的else必须写, 否则返回null</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#75715e>--用CASE表达式写正确的更新操作
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>UPDATE</span> Salaries
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>SET</span> salary <span style=color:#f92672>=</span> <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> salary <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>300000</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>THEN</span> salary <span style=color:#960050;background-color:#1e0010>＊</span> <span style=color:#ae81ff>0</span>.<span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>WHEN</span> salary <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>250000</span> <span style=color:#66d9ef>AND</span> salary <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>280000</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>THEN</span> salary <span style=color:#960050;background-color:#1e0010>＊</span> <span style=color:#ae81ff>1</span>.<span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>ELSE</span> salary <span style=color:#66d9ef>END</span>;
</span></span></code></pre></td></tr></table></div></div><p>调换主键值的方便写法</p><p>SomeTable</p><p><img loading=lazy src=https://res.weread.qq.com/wrepub/epub_26211874_22 alt></p><p>不使用case</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#75715e>--1．将a转换为中间值d
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>UPDATE</span> SomeTable
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>SET</span> p_key <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;d&#39;</span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>WHERE</span> p_key <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;a&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>--2．将b调换为a
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>UPDATE</span> SomeTable
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>SET</span> p_key <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;a&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>WHERE</span> p_key <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;b&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>--3．将d调换为b
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#66d9ef>UPDATE</span> SomeTable
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>SET</span> p_key <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;b&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>WHERE</span> p_key <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;d&#39;</span>;
</span></span></code></pre></td></tr></table></div></div><p>使用case</p><ul><li>适用于Oracle, DB2, SQL Server</li><li>不适用于PostgreSQL, MySQWL</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#75715e>--用CASE表达式调换主键值
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>UPDATE</span> SomeTable
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>SET</span> p_key <span style=color:#f92672>=</span> <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> p_key <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;a&#39;</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>THEN</span> <span style=color:#e6db74>&#39;b&#39;</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>WHEN</span> p_key <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;b&#39;</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>THEN</span> <span style=color:#e6db74>&#39;a&#39;</span>
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>ELSE</span> p_key <span style=color:#66d9ef>END</span>
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>WHERE</span> p_key <span style=color:#66d9ef>IN</span> (<span style=color:#e6db74>&#39;a&#39;</span>, <span style=color:#e6db74>&#39;b&#39;</span>);
</span></span></code></pre></td></tr></table></div></div><h1 id=表之间的数据匹配>表之间的数据匹配<a hidden class=anchor aria-hidden=true href=#表之间的数据匹配>#</a></h1><p>课程一览 CourseMaster</p><p><img loading=lazy src=https://res.weread.qq.com/wrepub/epub_26211874_25 alt></p><p>开设的课程 OpenCourses</p><p><img loading=lazy src=https://res.weread.qq.com/wrepub/epub_26211874_26 alt></p><p>我们要用这两张表来生成下面这样的交叉表</p><pre tabindex=0><code>    course_name   6月   7月   8月
    -----------  ----  ----  ----
    会计入门         ○    ×     ×
    财务知识         ×    ×    ○
    簿记考试         ○    ×     ×
    税务师           ○    ○    ○
</code></pre><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#75715e>--表的匹配：使用IN谓词
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>SELECT</span> course_name,
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> course_id <span style=color:#66d9ef>IN</span>
</span></span><span style=display:flex><span>                        (<span style=color:#66d9ef>SELECT</span> course_id <span style=color:#66d9ef>FROM</span> OpenCourses
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>month</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>200706</span>) <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;○&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>ELSE</span><span style=color:#e6db74>&#39;×&#39;</span><span style=color:#66d9ef>END</span> <span style=color:#66d9ef>AS</span> <span style=color:#e6db74>&#34;6月&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> course_id <span style=color:#66d9ef>IN</span>
</span></span><span style=display:flex><span>                        (<span style=color:#66d9ef>SELECT</span> course_id <span style=color:#66d9ef>FROM</span> OpenCourses
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>month</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>200707</span>) <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;○&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>ELSE</span><span style=color:#e6db74>&#39;×&#39;</span><span style=color:#66d9ef>END</span> <span style=color:#66d9ef>AS</span> <span style=color:#e6db74>&#34;7月&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> course_id <span style=color:#66d9ef>IN</span>
</span></span><span style=display:flex><span>                        (<span style=color:#66d9ef>SELECT</span> course_id <span style=color:#66d9ef>FROM</span> OpenCourses
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>month</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>200708</span>) <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;○&#39;</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>ELSE</span><span style=color:#e6db74>&#39;×&#39;</span><span style=color:#66d9ef>END</span>  <span style=color:#66d9ef>AS</span> <span style=color:#e6db74>&#34;8月&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>FROM</span> CourseMaster;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>--表的匹配：使用EXISTS谓词
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>SELECT</span> CM.course_name,
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> <span style=color:#66d9ef>EXISTS</span>
</span></span><span style=display:flex><span>                        (<span style=color:#66d9ef>SELECT</span> course_id <span style=color:#66d9ef>FROM</span> OpenCourses OC
</span></span><span style=display:flex><span>                          <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>month</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>200706</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                              <span style=color:#66d9ef>AND</span> OC.course_id <span style=color:#f92672>=</span> CM.course_id) <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;○&#39;</span>
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>ELSE</span><span style=color:#e6db74>&#39;×&#39;</span><span style=color:#66d9ef>END</span> <span style=color:#66d9ef>AS</span> <span style=color:#e6db74>&#34;6月&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> <span style=color:#66d9ef>EXISTS</span>
</span></span><span style=display:flex><span>                          (<span style=color:#66d9ef>SELECT</span> course_id <span style=color:#66d9ef>FROM</span> OpenCourses OC
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>month</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>200707</span>
</span></span><span style=display:flex><span>                              <span style=color:#66d9ef>AND</span> OC.course_id <span style=color:#f92672>=</span> CM.course_id) <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;○&#39;</span>
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>ELSE</span><span style=color:#e6db74>&#39;×&#39;</span><span style=color:#66d9ef>END</span> <span style=color:#66d9ef>AS</span> <span style=color:#e6db74>&#34;7月&#34;</span>,
</span></span><span style=display:flex><span>              <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> <span style=color:#66d9ef>EXISTS</span>
</span></span><span style=display:flex><span>                          (<span style=color:#66d9ef>SELECT</span> course_id <span style=color:#66d9ef>FROM</span> OpenCourses OC
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>WHERE</span> <span style=color:#66d9ef>month</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>200708</span>
</span></span><span style=display:flex><span>                              <span style=color:#66d9ef>AND</span> OC.course_id <span style=color:#f92672>=</span> CM.course_id) <span style=color:#66d9ef>THEN</span><span style=color:#e6db74>&#39;○&#39;</span>
</span></span><span style=display:flex><span>                  <span style=color:#66d9ef>ELSE</span><span style=color:#e6db74>&#39;×&#39;</span><span style=color:#66d9ef>END</span>  <span style=color:#66d9ef>AS</span> <span style=color:#e6db74>&#34;8月&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>FROM</span> CourseMaster CM;
</span></span></code></pre></td></tr></table></div></div><p>无论使用IN还是EXISTS，得到的结果是一样的，但从性能方面来说，EXISTS更好。通过EXISTS进行的子查询能够用到“month, course_id”这样的主键索引，
因此尤其是当表OpenCourses里数据比较多的时候更有优势。</p><h1 id=在case表达式中使用聚合函数>在CASE表达式中使用聚合函数<a hidden class=anchor aria-hidden=true href=#在case表达式中使用聚合函数>#</a></h1><p>假设这里有一张显示了学生及其加入的社团的一览表。如表StudentClub所示，这张表的主键是“学号、社团ID”，存储了学生和社团之间多对多的关系。</p><p>StudentClub</p><p><img loading=lazy src=https://res.weread.qq.com/wrepub/epub_26211874_28 alt></p><p>我们按照下面的条件查询这张表里的数据。</p><ol><li>获取只加入了一个社团的学生的社团ID。</li><li>获取加入了多个社团的学生的主社团ID。</li></ol><p>条件1的SQL</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#75715e>--条件1：选择只加入了一个社团的学生
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>SELECT</span> std_id, <span style=color:#66d9ef>MAX</span>(club_id) <span style=color:#66d9ef>AS</span> main_club
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>FROM</span> StudentClub
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> std_id
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>HAVING</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#960050;background-color:#1e0010>＊</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>;
</span></span></code></pre></td></tr></table></div></div><p>执行结果1</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    std_id   main_club
</span></span><span style=display:flex><span>    <span style=color:#75715e>------   ----------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#ae81ff>300</span>       <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>400</span>       <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>500</span>       <span style=color:#ae81ff>6</span>
</span></span></code></pre></td></tr></table></div></div><p>条件2的SQL</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#75715e>--条件2：选择加入了多个社团的学生
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>SELECT</span> std_id, club_id <span style=color:#66d9ef>AS</span> main_club
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>FROM</span> StudentClub
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>WHERE</span> main_club_flg <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Y&#39;</span>;
</span></span></code></pre></td></tr></table></div></div><p>执行结果2</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    std_id  main_club
</span></span><span style=display:flex><span>    <span style=color:#75715e>------  ----------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#ae81ff>100</span>     <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>200</span>     <span style=color:#ae81ff>3</span>
</span></span></code></pre></td></tr></table></div></div><p>如果使用CASE表达式，下面这一条SQL语句就可以了</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>    <span style=color:#66d9ef>SELECT</span>  std_id,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#960050;background-color:#1e0010>＊</span>) <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span>  <span style=color:#75715e>--只加入了一个社团的学生
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>THEN</span> <span style=color:#66d9ef>MAX</span>(club_id)
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>ELSE</span> <span style=color:#66d9ef>MAX</span>(<span style=color:#66d9ef>CASE</span> <span style=color:#66d9ef>WHEN</span> main_club_flg <span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Y&#39;</span>
</span></span><span style=display:flex><span>                              <span style=color:#66d9ef>THEN</span> club_id
</span></span><span style=display:flex><span>                              <span style=color:#66d9ef>ELSE</span> <span style=color:#66d9ef>NULL</span> <span style=color:#66d9ef>END</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>END</span> <span style=color:#66d9ef>AS</span> main_club
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>FROM</span> StudentClub
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> std_id;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    std_id   main_club
</span></span><span style=display:flex><span>    <span style=color:#75715e>------   ----------
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#ae81ff>100</span>       <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>200</span>       <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>300</span>       <span style=color:#ae81ff>4</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>400</span>       <span style=color:#ae81ff>5</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>500</span>       <span style=color:#ae81ff>6</span>
</span></span></code></pre></td></tr></table></div></div><h1 id=本节小结>本节小结<a hidden class=anchor aria-hidden=true href=#本节小结>#</a></h1><p>最后说一点细节的东西。CASE表达式经常会因为同VB和C语言里的CASE“语句”混淆而被叫作CASE语句。但是准确来说，它并不是语句，而是和1+1或者a/b一样
属于表达式的范畴。结束符END确实看起来像是在标记一连串处理过程的终结，所以初次接触CASE表达式的人容易对这一点感到困惑。“表达式”和“语句”的名称
区别恰恰反映了两者在功能处理方面的差异。</p><p>作为表达式，CASE表达式在执行时会被判定为一个固定值，因此它可以写在聚合函数内部；也正因为它是表达式，所以还可以写在SELECE子句、GROUP BY
子句、WHERE子句、ORDER BY子句里。简单点说，在能写列名和常量的地方，通常都可以写CASE表达式。从这个意义上来说，与CASE表达式最接近的不是面向
过程语言里的CASE语句，而是Lisp和Scheme等函数式语言里的case和cond这样的条件表达式。</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=https://jdxj.github.io/posts/books/sql%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B/%E7%AC%AC1%E7%AB%A0-%E7%A5%9E%E5%A5%87%E7%9A%84sql/1-2-%E8%87%AA%E8%BF%9E%E6%8E%A5%E7%9A%84%E7%94%A8%E6%B3%95/><span class=title>« Prev</span><br><span>1-2 自连接的用法</span>
</a><a class=next href=https://jdxj.github.io/posts/articles/smantic/><span class=title>Next »</span><br><span>Smantic</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 1-1 CASE表达式 on x" href="https://x.com/intent/tweet/?text=1-1%20CASE%e8%a1%a8%e8%be%be%e5%bc%8f&amp;url=https%3a%2f%2fjdxj.github.io%2fposts%2fbooks%2fsql%25E8%25BF%259B%25E9%2598%25B6%25E6%2595%2599%25E7%25A8%258B%2f%25E7%25AC%25AC1%25E7%25AB%25A0-%25E7%25A5%259E%25E5%25A5%2587%25E7%259A%2584sql%2f1-1-case%25E8%25A1%25A8%25E8%25BE%25BE%25E5%25BC%258F%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 1-1 CASE表达式 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fjdxj.github.io%2fposts%2fbooks%2fsql%25E8%25BF%259B%25E9%2598%25B6%25E6%2595%2599%25E7%25A8%258B%2f%25E7%25AC%25AC1%25E7%25AB%25A0-%25E7%25A5%259E%25E5%25A5%2587%25E7%259A%2584sql%2f1-1-case%25E8%25A1%25A8%25E8%25BE%25BE%25E5%25BC%258F%2f&amp;title=1-1%20CASE%e8%a1%a8%e8%be%be%e5%bc%8f&amp;summary=1-1%20CASE%e8%a1%a8%e8%be%be%e5%bc%8f&amp;source=https%3a%2f%2fjdxj.github.io%2fposts%2fbooks%2fsql%25E8%25BF%259B%25E9%2598%25B6%25E6%2595%2599%25E7%25A8%258B%2f%25E7%25AC%25AC1%25E7%25AB%25A0-%25E7%25A5%259E%25E5%25A5%2587%25E7%259A%2584sql%2f1-1-case%25E8%25A1%25A8%25E8%25BE%25BE%25E5%25BC%258F%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 1-1 CASE表达式 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fjdxj.github.io%2fposts%2fbooks%2fsql%25E8%25BF%259B%25E9%2598%25B6%25E6%2595%2599%25E7%25A8%258B%2f%25E7%25AC%25AC1%25E7%25AB%25A0-%25E7%25A5%259E%25E5%25A5%2587%25E7%259A%2584sql%2f1-1-case%25E8%25A1%25A8%25E8%25BE%25BE%25E5%25BC%258F%2f&title=1-1%20CASE%e8%a1%a8%e8%be%be%e5%bc%8f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 1-1 CASE表达式 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjdxj.github.io%2fposts%2fbooks%2fsql%25E8%25BF%259B%25E9%2598%25B6%25E6%2595%2599%25E7%25A8%258B%2f%25E7%25AC%25AC1%25E7%25AB%25A0-%25E7%25A5%259E%25E5%25A5%2587%25E7%259A%2584sql%2f1-1-case%25E8%25A1%25A8%25E8%25BE%25BE%25E5%25BC%258F%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 1-1 CASE表达式 on whatsapp" href="https://api.whatsapp.com/send?text=1-1%20CASE%e8%a1%a8%e8%be%be%e5%bc%8f%20-%20https%3a%2f%2fjdxj.github.io%2fposts%2fbooks%2fsql%25E8%25BF%259B%25E9%2598%25B6%25E6%2595%2599%25E7%25A8%258B%2f%25E7%25AC%25AC1%25E7%25AB%25A0-%25E7%25A5%259E%25E5%25A5%2587%25E7%259A%2584sql%2f1-1-case%25E8%25A1%25A8%25E8%25BE%25BE%25E5%25BC%258F%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 1-1 CASE表达式 on telegram" href="https://telegram.me/share/url?text=1-1%20CASE%e8%a1%a8%e8%be%be%e5%bc%8f&amp;url=https%3a%2f%2fjdxj.github.io%2fposts%2fbooks%2fsql%25E8%25BF%259B%25E9%2598%25B6%25E6%2595%2599%25E7%25A8%258B%2f%25E7%25AC%25AC1%25E7%25AB%25A0-%25E7%25A5%259E%25E5%25A5%2587%25E7%259A%2584sql%2f1-1-case%25E8%25A1%25A8%25E8%25BE%25BE%25E5%25BC%258F%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 1-1 CASE表达式 on ycombinator" href="https://news.ycombinator.com/submitlink?t=1-1%20CASE%e8%a1%a8%e8%be%be%e5%bc%8f&u=https%3a%2f%2fjdxj.github.io%2fposts%2fbooks%2fsql%25E8%25BF%259B%25E9%2598%25B6%25E6%2595%2599%25E7%25A8%258B%2f%25E7%25AC%25AC1%25E7%25AB%25A0-%25E7%25A5%259E%25E5%25A5%2587%25E7%259A%2584sql%2f1-1-case%25E8%25A1%25A8%25E8%25BE%25BE%25E5%25BC%258F%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://jdxj.github.io>jdxj</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>