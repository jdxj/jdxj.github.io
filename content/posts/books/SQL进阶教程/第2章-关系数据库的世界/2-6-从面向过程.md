---
title: "2-6 从面向过程思维向声明式思维, 面向集合思维转变的7个关键点"
date: 2023-03-14T21:29:10+08:00
draft: false
---

不管是面向过程语言还是文件系统，都是将复杂的东西看成是由简单单元组合而成的——这是一种**还原论**的思维方式。

SQL中没有赋值或者循环的处理，数据也不以记录为单位进行处理，而以集合为单位进行处理。SQL和关系数据库的思维方式更像是一种**整体论**的思维方式。

# 1．用CASE表达式代替IF语句和CASE语句。SQL更像一种函数式语言

之所以叫它CASE“表达式”而不是CASE“语句”（statement），是因为CASE表达式与1+(2-4)或者(x＊y)/z一样，都是表达式，在执行时会被整体当作一个值
来处理。既然同样是表达式，那么能写1+1这样的表达式的地方就都能写CASE表达式，而且因为CASE表达式最终会作为一个确定的值来处理，所以我们也可以把
CASE表达式当作聚合函数的参数来使用。

```lisp
    'Lisp中使用cond函数进行条件分支
    cond(
        ((= x 1)'x是1')
          ((= x 2)'x是2')
          (t 'x是1和2以外的数’))
```

```sql
    --SQL中使用CASE表达式进行条件分支
    CASE WHEN x = 1 THEN'x是1'
        WHEN x = 2 THEN'x是2'
        ELSE 'x是1和2以外的数’
     END
```

参考→[1-3节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-3-三值逻辑和NULL.md">}})


# 2．用GROUP BY和关联子查询代替循环

SQL中没有专门的循环语句。虽然可以使用游标实现循环，但是这样的话还是面向过程的做法，和纯粹的SQL没有关系。SQL在设计之初，就有意地避免了循环。

参考→[1-6节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-6-用关联子查询比较行与行.md" >}})、
[1-7节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-7-用SQL进行集合运算.md" >}})

# 3．表中的行没有顺序

将表看成文件的最大问题是会误认为表中的行是有顺序的。

- 在关系数据库中，从表中读取数据时的的确确会发生这样的情况。读出的数据不一定是按照INSERT的顺序排列的，因为SQL在处理数据时不需要它们这样。
  SQL在处理数据时可以完全不依赖顺序。
- 在定义视图时指定ORDER BY子句（如果某种数据库支持这种写法，那么它本身就有问题），或者轻易地使用Oracle中的rownum这样依赖具体实现的
  “行编号”列，都是典型的依赖顺序的不好的写法。

参考→[1-4节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-4-HAVING子句的力量.md" >}})、
[1-9节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-9-用SQL处理数列.md" >}})、
[1-10节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-10-HAVING子句又回来了.md" >}})

# 4．将表看成集合

实际上，一张表并非对应一个文件，读取表时也并不是像读取文件一样一行一行地进行的。

参考→[1-2节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-2-自连接的用法.md" >}})

# 5．理解EXISTS谓词和“量化”的概念

在SQL中，谓词逻辑的主要应用场景是“将多行数据作为整体”处理的时候。谓词逻辑中具有能将多个对象作为一个整体来处理的工具“量化符”。对于SQL来说，
量化符就是EXISTS谓词。

参考→[1-8节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-8-EXISTS谓词的用法.md" >}})、
[1-9节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-9-用SQL处理数列.md" >}})

# 6．学习HAVING子句的真正价值

HAVING子句是集中体现了SQL之面向集合理念的功能。

参考→[1-4节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-4-HAVING子句的力量.md" >}})、
[1-10节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-10-HAVING子句又回来了.md" >}})

# 7．不要画长方形，去画圆

传统的结构图(structure diagram), 数据流图(data flow diagram)用于描述动态数据, 而SQL只是用来描述所需数据的查询条件的，并不能描述动态的
处理过程。

能够准确描述静态数据模型的标准工具是维恩图

能否深刻理解并灵活使用嵌套子集（=递归集合），可以说是衡量SQL编程能力是否达到中级水平的关键。

![](https://res.weread.qq.com/wrepub/epub_26211874_370)

参考→[1-4节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-4-HAVING子句的力量.md" >}})、
[1-7节]({{< ref "posts/books/SQL进阶教程/第1章-神奇的SQL/1-7-用SQL进行集合运算.md" >}})
