---
title: "2-9 消灭NULL委员会"
date: 2023-03-16T20:23:52+08:00
---

# ~告全体数据库工程师书~

NULL这个怪物最可怕的地方：一开始会让我们觉得很好用，于是在设计系统时，我们会非常自然地保留它，但当注意到问题的时候，系统已经变得非常复杂、低
效、不符合预期了，开发和维护也变得非常困难。

# 为什么NULL如此惹人讨厌

1. 在进行SQL编码时，必须考虑违反人类直觉的三值逻辑。
2. 在指定IS NULL、IS NOT NULL的时候，不会用到索引，因而SQL语句执行起来性能低下。
3. 如果四则运算以及SQL函数的参数中包含NULL，会引起“NULL的传播”。
4. 在接收SQL查询结果的宿主语言中，NULL的处理方法没有统一标准。
5. 与一般列的值不同，NULL是通过在数据行的某处加上多余的位（bit）来实现的。因此NULL会使程序占据更多的存储空间，使得检索性能变差。

对于第3个原因，我们来稍微解释一下。例如，如果四则运算中包含NULL，那么运算结果也肯定都是NULL。

```sql
    1 + NULL = NULL
    2- NULL = NULL
    3 ＊ NULL = NULL
    4 / NULL = NULL
    NULL / 0 = NULL
```

# 并不能完全消除NULL

无法完全消除NULL的原因是它扎根于关系数据库的底层中。仅仅靠在表中所有列加上NOT NULL的约束是不够的。因为即使这样做，在使用外连接，或者SQL-99
中添加的带CUBE或ROLLUP的GROUP BY时，还是很容易引入NULL的。

# 编号：使用异常编号

标志性编号, 例如性别

- 使用varchar/char not null类型
- 1: 男性, 2: 女性, 0: 未知, 9: 不适用

# 名字：使用“无名氏”

一般来说，与编号相比，名字被用于聚合的频度很低，大多时候只作为冗余列使用。我们不用刻意地消除其中的NULL，但是最好还是让NULL从名字列中消失。

# 数值：用0代替

- 转换为0。
- 如果一定要区分0和NULL，那么允许使用NULL。

# 日期：用最大值或最小值代替

当需要表示开始日期和结束日期这样的“期限”的时候，我们可以使用0000-01-01或者9999-12-31这样可能存在的最大值或最小值来处理。

当默认值原本就不清楚的时候，例如历史事件发生的日期，或者某人的生日等，也就是当NULL的含义是“未知”的时候，这时可以允许使用NULL。
