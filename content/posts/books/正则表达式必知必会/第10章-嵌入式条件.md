---
title: "第10章 嵌入式条件"
date: 2023-07-15T18:33:01+08:00
---

在表达式的内部嵌入条件处理。

## 10.1 为什么要嵌入条件

并非所有的正则表达式实现都支持条件处理。

## 10.2 正则表达式里的条件

### 10.2.1　反向引用条件

用来定义这种条件的语法是(?(backreference)true)，其中?表明这是一个条件，括号里的backreference是一个反向引用，仅当反向引用立即出现时，才对表
达式求值。

文本

```html
<!-- Nav bar -->
<div>
<a href="/home"><img src="/images/home.gif"></a>
<img src="/images/spacer.gif">
<a href="/search"><img src="/images/search.gif"></a>
<img src="/images/spacer.gif">
<a href="/help"><img src="/images/help.gif"></a>
</div>
```

正则

```regexp
(<[Aa]\s+[^>]+>\s*)?<[Ii][Mm][Gg]\s+[^>]+>(?(1)\s*<\/[Aa]>)
```

- `(<[Aa]\s+[^>]+>\s*)?`匹配一个`<A>`或`<a>`标签（以及可能存在的任意属性），这个标签可有可无
- `<[Ii][Mm][Gg]\s+[^>]+>`匹配一个`<img>`标签（大小写均可）及其任意属性。
- `(?(1)\s*<\/[Aa]>)`的起始部分是一个条件: `?(1)`表示仅当第一个反向引用（`<A>`标签）存在，才继续匹配`\s*<\/[Aa]>`

在条件里，反向引用编号（本例中的1）在条件中不需要被转义。

条件还可以有else表达式, 语法是(?(backreference)true|false)。

- 此语法接受一个条件和两个分别在符合/不符合该条件时执行的表达式。

```regexp
(\()?\d{3}(?(1)\)|-)\d{3}-\d{4}
```

### 10.2.2 环视条件

环视条件允许根据向前查看或向后查看操作是否成功来决定要不要执行表达式。

环视条件的语法与反向引用条件的语法大同小异，只需把反向引用（括号里的反向引用编号）替换为一个完整的环视表达式就行了。

文本

```text
11111
22222
33333-
44444-4444
```

正则

```regexp
(?#会把33333-也匹配上)
\d{5}(-\d{4})?
(?#排除33333-)
\d{5}(?(?=-)-\d{4})
```

## 10.3 小结
