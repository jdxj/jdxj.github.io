---
title: "第1章 万维网与HTTP"
date: 2023-03-16T21:40:27+08:00
draft: false
---

## 1.1 万维网的原理

HTTP是访问远程Web应用和资源的关键技术。

### 1.1.1 因特网与万维网

因特网(Internet)和万维网(World Wide Web或Web)的区别

- 因特网是使用IP（Internet Protocol，因特网协议）连接在一起实现消息传递的计算机构成的网络。因特网上有很多服务，包括万维网，以及电子邮件、
  文件共享、因特网电话等。
- 因此万维网（注意，是World Wide Web，简称Web）只是因特网上的一种服务形式，但其却是人们最常看到的形式，因为人们经常会通过Web应用（如
  Gmail、Hotmail和Yahoo!）来收发邮件。我们日常所说的上网，既可以理解为上万维网，也可以理解为上因特网。

Tim Berners-Lee当初发明万维网时，一共创造了三项核心技术

- HTTP
- URL
- HTML

### 1.1.2 打开网页时会发生什么

假设我们打开浏览器访问www.google.com。在接下来的几秒钟内，会发生下面这些事情

图1.1　浏览器请求网页时的典型交互过程

![](https://res.weread.qq.com/wrepub/epub_32517945_4)

由于因特网是全球性的，所以大公司通常会把服务器部署在世界各地。我们在向DNS查询IP地址时，通常会得到一个距离你最近的服务器的IP地址，以便你能快
速访问。

**怎么没有IPv5**? IP包的前4位表示版本，理论上限是15个版本。在被广泛使用的IPv4以前，出现过0～3共4个实验性版本。但是，直到第4版，这几个版本一直没有被标准化（参
见: https://tools.ietf.org/html/rfc760 , 这个协议后来被升级和替换了，见 https://tools.ietf.org/html/rfc791 )。此后，第5个版本被
指定为Internet Stream Protocol，其主要在实时音频和视频流应用中使用，与VoIP（Voice over IP，IP语音）后来的发展类似。可是，这个版本一直
没启用，原因之一就是存在与第4版一样的地址限制。后来第6版出来的时候，第5版的工作被叫停，于是IPv6就成了IPv4的后续版本。据说一开始由于人们以为
6也被占用了，所以IPv6最早被称为第7版(参见 https://archive.is/QqU73#selection-417.1-417.15 )。版本7、8、9同样也被占用，而且以后也不
会再使用了。假如IPv6还有后续版本，很可能会是IPv10或更高的版本。到时候，无疑还会导致与今天类似的疑惑。

你的浏览器会自动将简短的网址（www.google.com）扩展为语法上更为准确的URL地址（http://www.google.com）。
而包含端口在内的完整URL应该是http://www.google.com:80，只不过在使用标准端口（80用于HTTP，443用于HTTPS）的情况下，浏览器会隐藏端口号。
如果使用的是非标准端口，端口就会被显示出来。比如在某些环境特别是**开发环境下，HTTP可以使用8080端口，HTTPS则可以使用8443端口**。

## 1.2 什么是HTTP

OSI模型（Open System Interconnection，开放式系统互联通信参考模型）

图1.2　网络数据传输的分层

![](https://res.weread.qq.com/wrepub/epub_32517945_5)

## 1.3 HTTP的语法和历史

### 1.3.1 HTTP/0.9

HTTP的第一个规范是1991年发布的0.9版本。

该规范指定

1. 通过TCP/IP（或类似的面向连接的服务）与服务器和端口（可选的，如果未指定端口，则使用80）建立连接。
2. 客户端应发送一行ASCII文本，包括GET、文档地址（无空格）、回车符和换行符（回车是可选的）。
3. 服务器使用HTML格式的消息进行响应，该消息被定义为“ASCII字符的字节流”。规范还指定，**“通过服务器关闭连接来终止消息”**，所以在每个请求之后
   都关闭连接。
4. 在处理错误时，规范声明：“错误响应以可读的文本显示，使用HTML语法。除了文本的内容，没有办法区分错误响应和正确响应。”
5. 在文档结尾处，规范指出：“请求是幂等的。服务器不需要在断开连接后存储关于请求的任何信息。”本规范为我们提供了HTTP的无状态特性，这是一把双刃
   剑，有利（这很简单）也有弊（因为必须附加HTTP cookies等技术以允许状态跟踪，这对于复杂的应用程序是必需的）。

HTTP/0.9可能仅有的指令

```
GET /section/page.html↵
```

### 1.3.2 HTTP/1.0

HTTP/1.0新增了一些关键特性

- 更多的请求方法。除了先前定义的GET方法，新增了HEAD和POST方法。
- 为所有的消息添加HTTP版本号字段。此字段是可选的，为了向后兼容，默认情况下使用HTTP/0.9。
- HTTP首部。它可以与请求和响应一起发送，以提供与正在执行的请求或发送的响应相关的更多信息。
- 一个三位整数的响应状态码，（例如）用来表示响应是否成功。此状态码还可以用来表示重定向请求、条件请求和错误状态

**HTTP/1.0旨在记录现实世界中多数Web服务器上已经发生的事情，而不是定义新的功能/语法。**

HTTP/1.0的方法

- GET方法与HTTP/0.9中的基本相同，但是新增的首部允许客户端发送条件GET（仅当在客户端上次请求之后，资源发生变化时，才请求资源内容；否则，告诉
  客户端资源没变化，继续使用旧的副本）。此外，**用户可以使用GET方法获取更多的资源，而不仅仅是超文本文档**，比如使用HTTP下载图像、视频或其他
  类型的媒体内容。
- HEAD方法允许客户端获取资源的所有元信息（例如HTTP头）而无须下载资源本身。
- POST方法允许客户端发送数据到Web服务器。也就是说，POST方法允许将内容作为HTTP请求的一部分从客户端发送到服务器，这表示
  **HTTP请求终于和HTTP响应一样，拥有了正文部分**。
- GET方法允许将数据包含在URL尾部指定的查询参数中发送，通常放在?字符之后。
- URL受到长度和内容方面的限制（例如，无法发送二进制数据），并且某些机密数据（密码、信用卡数据等）也不应出现在URL中，因为很容易就可以在屏幕和
  浏览器历史记录中看到这些数据。
- POST方法通常是一种更好的数据发送方式，其中的数据也不是那么显而易见（尽管在通过透明的HTTP而不是安全的HTTPS发送时仍应小心）。
- 是GET请求是幂等的，而POST请求不是。

HTTP请求首部

![](https://res.weread.qq.com/wrepub/epub_32517945_18)

没有首部的情况

![](https://res.weread.qq.com/wrepub/epub_32517945_19)

可以发送具有相同名称的多个首部

![](https://res.weread.qq.com/wrepub/epub_32517945_20)

等于

![](https://res.weread.qq.com/wrepub/epub_32517945_21)

一个经典的HTTP/1.0 GET请求

![](https://res.weread.qq.com/wrepub/epub_32517945_22)

HTTP响应状态码

![](https://res.weread.qq.com/wrepub/epub_32517945_23)

表1.1　HTTP/1.0响应码

![](https://res.weread.qq.com/wrepub/epub_32517945_24)

HTTP响应首部

![](https://res.weread.qq.com/wrepub/epub_32517945_25)

### 1.3.3 HTTP/1.1

HTTP/1.1更像是对HTTP/1.0的调整，它没有从根本上改变协议。从0.9到1.0是一个较大的变化，增加了HTTP首部。HTTP/1.1做了进一步的改进，以便充分
利用HTTP协议（例如，持久连接、强制响应首部、更好的缓存选项和分块编码）。更重要的是，它提供了一个正式标准，后来的万维网正是基于它构筑。虽然
HTTP的基础知识很容易理解，但是里面许多错综复杂的细节、实现方式的不同，以及正式标准的缺乏使得它难以扩展。

强制添加Host首部

如今，很多Web服务器上面有多个网站（虚拟主机托管），所以告诉服务器要访问哪个网站和访问哪个相对URL同样重要。此功能可以通过下面的方法实现：将
HTTP请求中的URL修改为完整的包含绝对路径的URL。但如果采用这种方法，则很多现有的Web服务器和客户端都不能正常运行。所以，我们在请求首部中添加
Host来实现该功能：

![](https://res.weread.qq.com/wrepub/epub_32517945_26)

指定强制Host首部字段，而不是将相对URL更改为绝对URL，带来了一些争论。HTTP/1.1引入的HTTP代理允许通过中间HTTP服务器连接到目标HTTP服务器。
代理的语法要求所有的请求使用完整的绝对URL，但实际的Web服务器（也称为源服务器）要求强制使用Host首部。

持久连接（也就是KEEP-ALIVE）

**HTTP/1.0服务器是支持持久连接的, 但不在HTTP/1.0规范中**

![](https://res.weread.qq.com/wrepub/epub_32517945_28)

服务器像往常一样响应，但如果它支持持久连接，它会在响应中包含一个Connection: Keep-Alive首部

![](https://res.weread.qq.com/wrepub/epub_32517945_29)

**HTTP/1.1不仅将持久连接添加到文档标准中，还将其作为默认行为**。即使响应中没有Connection:Keep-Alive首部，也可以假定任何HTTP/1.1连接都
使用持久连接。如果服务器确实想要关闭连接，无论出于何种原因，则它必须在响应中显式包含Connection:close HTTP首部

![](https://res.weread.qq.com/wrepub/epub_32517945_30)

在此基础上，HTTP/1.1增加了**管道**的概念，因此应该可以通过同一个持久连接发送多个请求并按顺序获取响应。

![](https://res.weread.qq.com/wrepub/epub_32517945_31)

由于某些原因，**管道化并没有流行起来**，并且客户端（浏览器）和服务器对管道化的支持都很差。因此，虽然持久连接允许在同一个TCP上顺序发出多个请
求，这也是一个很好的性能改进，但大多数HTTP/1.1的实现仍然是遵循请求响应再请求再响应的模式的。当一个请求被处理时，HTTP连接被阻塞，不能用于其
他请求。

其他新功能

- HTTP/1.1又定义了新的方法，如PUT、OPTIONS和比较少见的CONNECT、TRACE及DELETE。
- 更好的缓存方法。这些方法允许服务器指示客户端将资源（例如CSS文件）存储在浏览器的缓存中，以便在以后需要时重复使用。在HTTP/1.1中引入的
  Cache-Control HTTP首部比HTTP/1.0中的Expires首部的选项更多。
- HTTP cookies，允许HTTP维护状态。
- 引入字符集（如本章的一些例子所示），在HTTP响应中新增语言选项。
- 支持代理。
- 支持权限验证。
- 新的状态码。
- 尾随首部

## 1.4 HTTPS简介

HTTPS是HTTP的安全版本，它使用TLS（Transport Layer Security，传输层加密）协议对传输中的消息进行加密，TLS的前身是我们熟知的SSL（Secure
Sockets Layer，安全套接字层）

HTTPS对HTTP消息添加了三个重要概念

- 加密——传输过程中第三方无法读取消息。
- 完整性校验——消息在传输过程中未被更改，因为整个加密消息已经过数字签名，并且该签名在解密之前已通过加密验证。
- 身份验证——服务器不是伪装的。

SSL、TLS、HTTPS和HTTP

- HTTPS使用SSL或TLS加密。SSL是由Netscape发明的。SSLv1从未在Netscape之外发布，因此第一个生产版本是1995年发布的SSLv2。1996年发布的
  SSLv3解决了一些安全漏洞。
- 由于SSL由Netscape拥有，因此它不是正式的互联网标准，尽管它随后由IETF作为历史文档发布。SSL被标准化为TLS（传输层加密）。
  - TLSv1.0与SSLv3类似，但它们不兼容。
  - TLSv1.1和TLSv1.2分别于2006年和2008年推出，并且它们更加安全。
  - TLSv1.3在2018年被批准为标准。虽然还需要一些时间它才能普及，但它更安全，更高效。
  - 在2014年，在SSLv3中发现了重大漏洞，SSLv3因此被要求停止使用，并且浏览器也停止对它的支持。从这时人们才开始大量向TLS迁移。在TLSv1.0中发
    现类似的漏洞后，安全专家强烈建议使用TLSv1.1或更高版本。

HTTPS使用公钥加密，服务器在用户首次连接时以数字证书的形式提供公钥。

- HTTPS的一个重大问题是，它只保证你正在连接到该服务器，而不能保证服务器值得信任。
- HTTPS站点通常在Web浏览器中显示为绿色挂锁，许多用户认为这意味着安全，但其实它仅仅意味着加密。

OpenSSL提供了一个s_client命令，可使用该命令将HTTP命令发送到HTTPS服务器，和使用Telnet类似：

![](https://res.weread.qq.com/wrepub/epub_32517945_33)

## 1.5 查看、发送和接收HTTP消息的工具

### 1.5.1 浏览器开发者工具

### 1.5.2 发送HTTP请求

Advanced REST Client

### 1.5.3 其他工具

curl, wget, httpie, SOAP-UI, Chrome的net-internals页面, Fiddler, Wireshark
