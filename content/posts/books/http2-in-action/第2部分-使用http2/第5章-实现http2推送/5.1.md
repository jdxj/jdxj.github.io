---
title: "5.1 什么是HTTP/2服务端推送"
date: 2023-03-25T11:17:24+08:00
---

HTTP/2服务端推送（以下称为HTTP/2推送）允许服务器发回客户端未请求的额外资源。

- HTTP/2多路复用技术允许在同一连接上并行请求所有资源，因为这样排队会减少，所以它优于HTTP/1。
- 如果没有HTTP/2推送，浏览器必须在下载初始页面之后才能请求这些关键的资源。

图5.1　关键资源需要一个额外的请求往返(http/1)

![](https://res.weread.qq.com/wrepub/epub_32517945_143)

图5.2　关键资源的往返延迟瀑布图(http/1)

![](https://res.weread.qq.com/wrepub/epub_32517945_144)

这个往返延迟催生了一些性能优化手段，如将样式通过`<style>`标签内联到HTML页面中，或类似的，通过`<script>`标签将JavasScript内联到HTML中。通过
内联这些关键资源，浏览器可以在原始页面下载解析之后马上开始渲染，而不需要等待附加的关键资源。

内联资源有几个缺点

- 需要将关键CSS提取出来防止页面过大, 但是该操作比较复杂, 也有可能造成重复代码
- 要求使用JavaScript来加载非关键CSS文件
- 变更困难(重复的地方都要改)

图5.3　使用HTTP/2推送可以避免关键资源的往返延迟

![](https://res.weread.qq.com/wrepub/epub_32517945_145)

> 服务器岂不是解析html才能发送被关联资源?

图5.4　使用HTTP/2推送在一个往返中接收所有请求的瀑布图

![](https://res.weread.qq.com/wrepub/epub_32517945_146)

图5.5　一个基本的网页请求流，不使用HTTP/2推送（左边）和使用HTTP/2推送（右边）的情况

![](https://res.weread.qq.com/wrepub/epub_32517945_147)

如果使用方法正确，HTTP/2推送可以减少加载时间。但如果你多推送了资源（客户端不需要，或者已经在缓存里），则将会延长加载时间。所以，在使用HTTP/2推送
时应该小心，经过考虑后再使用。

**HTTP/2推送是否能替代WebSockets或者SSE**

诸如WebSockets和服务器发送事件（SSE）之类的技术真正允许双向流，HTTP/2中不是真正的双向流，一切都仍然是从客户端请求发起的。按照HTTP/2推送现在的
规范，它不是WebSockets或SSE的替代品，但如果以后它进一步扩展的话，也许有替代它们的机会
