---
title: "第9章TCP, QUIC和HTTP/3"
date: 2023-03-29T20:56:14+08:00
draft: true
---

## 9.1 TCP的低效率因素，以及HTTP

TCP运行的基本方式会导致5个主要的问题，它们至少影响到了HTTP：

- 有一个连接创建的延迟。要在连接开始时协商发送方和接收方可以使用的序列号。
- TCP慢启动算法限制了TCP的性能，它小心翼翼地处理发送的数据量，以尽可能防止重传。
- 不充分使用连接会导致限流阈值降低。如果连接未被充分使用，TCP会将拥塞窗口的大小减小，因为它不确定在上个最优的拥塞窗口之后网络参数有没有发生变化。
- 丢包也会导致TCP的限流阈值降低。TCP认为所有的丢包都是由窗口拥堵造成的，但其实并不是。
- 数据包可能被排队。乱序接收到的数据包会被排队，以保证数据是有序的。

### 9.1.1 创建HTTP连接的延迟

图9.1　HTTPS连接所需要的TCP和HTTPS设置

![](https://res.weread.qq.com/wrepub/epub_32517945_324)

### 9.1.2 TCP拥塞控制对性能的影响

拥塞控制算法和概念增加了稳定性，但也带来了低效的问题

**TCP慢启动**

表9.1　常见的TCP慢启动增长

![](https://res.weread.qq.com/wrepub/epub_32517945_327)

图9.4　TCP慢启动到最佳容量的过程

![](https://res.weread.qq.com/wrepub/epub_32517945_328)

当达到最大容量之后，如果没有发生丢包，TCP拥塞控制就进入拥塞避免阶段，随后拥塞窗口还会持续增长，但会变成慢得多的线性增长, 直到它开始看到丢包，认为
到了最大容量

TCP慢启动很慢吗

- 因为TCP慢启动的指数增长特性，所以按大多数定义来说它并不慢。

尽量把东西放到前14KB中

开始的10个TCP数据包（至少）会被如下消息使用：

- 两个HTTPS响应（Server Hello和Change Spec）
- 两个HTTP/2 SETTINGS帧（服务器发送一个，另外一个用来确认客户端的SETTINGS帧）
- 一个HEADERS帧，响应第一个请求

表9.2　通常使用6个连接的TCP慢启动增长

![](https://res.weread.qq.com/wrepub/epub_32517945_329)

**连接闲置降低性能**

在连接刚启动时和连接闲置时，TCP慢启动算法会导致延迟。TCP比较小心谨慎，在闲置一段时间后，网络情况可能发生变化，所以TCP将拥塞窗口大小降低，重新进行
慢启动流程，以再次找到最佳的拥塞窗口大小。

**丢包降低TCP性能**

