---
title: "第12章 指针和数组"
date: 2023-07-05T12:52:28+08:00
---

## 12.1 指针的算术运算

```c
int a[10], *p;
p = &a[0];
*p = 5;
```

C语言支持3种格式的指针算术运算

- 指针加上整数；
- 指针减去整数；
- 两个指针相减。

### 12.1.1 指针加上整数

```c
int a[10], *p, *q, i;
p = &a[2];
q = p + 3;
p += 6;
```

### 12.1.2 指针减去整数

```c
p = &a[8];
q = p - 3;
p -= 6;
```

### 12.1.3 两个指针相减

当两个指针相减时，结果为指针之间的距离

- 如果p指向a[i]且q指向a[j]，那么p-q就等于i-j

```c
p = &a[5];
q = &a[1];

i = p - q;    /* i is 4 */
i = q - p;    /* i is -4 */
```

### 12.1.4 指针比较

比较的结果依赖于数组中两个元素的相对位置。例如，在下面的赋值后p <= q的值是0，而p >= q的值是1。

```c
p = &a[5];
q = &a[1];
```

### 12.1.5 指向复合常量的指针(c99)

```c
int *p = (int []){3, 0, 3, 4, 1};
```

## 12.2 指针用于数组处理

```c
#define N 10
...
int a[N], sum, *p;
...
sum = 0;
for (p = &a[0]; p < &a[N]; p++)
  sum += *p;
```

### *运算符和++运算符的组合

把值存入一个数组元素中，然后前进到下一个元素

```c
a[i++] = j;
*p++ = j;
// 与上面相同
*(p++) = j;
```

![](https://res.weread.qq.com/wrepub/epub_31359737_502)

## 12.3 用数组名作为指针

可以用数组的名字作为指向数组第一个元素的指针。这种关系简化了指针的算术运算，而且使数组和指针更加通用。

```c
int a[10];
*a = 7;        /* stores 7 in a[0] */
*(a+1) = 12;      /* store 12 in a[1] */

for (p = a; p < a + N; p++)
  sum += *p;
```

**不能给数组名赋新的值**

```c
while (*a != 0)
  a++;              /*** WRONG ***/
// 需要给新变量
p = a;
while (*p != 0)
  p++;
```

### 12.3.1 数组型实际参数（改进版）

数组名在传递给函数时，总是被视为指针

为了指明数组型形式参数不会被改变，可以在其声明中包含单词const：

```c
int find_largest(const int a[], int n)
{
  ...
}
```

如果需要，可以把数组型形式参数声明为指针

```c
int find_largest(int *a, int n)
{
  ...
}
```

对于形式参数而言，声明为数组跟声明为指针是一样的；但是对变量而言，声明为数组跟声明为指针是不同的。

可以给形式参数为数组的函数传递数组的“片断”

```c
largest = find_largest(&b[5], 10);
```

### 12.3.2 用指针作为数组名

```c
#define N 10
...
int a[N], i, sum = 0, *p = a;
...
for (i = 0; i < N; i++)
  sum += p[i];
```

## 12.4 指针和多维数组

### 12.4.1 处理多维数组的元素

```c
int a[NUM_ROWS][NUM_COLS];
int *p;
...
for (p = &a[0][0]; p <= &a[NUM_ROWS-1][NUM_COLS-1]; p++)
  *p = 0;
```

### 12.4.2 处理多维数组的行

对数组a的第i行清零

```c
int a[NUM_ROWS][NUM_COLS], *p, i;
...
for (p = a[i]; p < a[i] + NUM_COLS; p++)
  *p = 0;
```

### 12.4.3 处理多维数组的列

下面的循环对数组a的第i列清零

- 这里把p声明为指向长度为NUM_COLS的整型数组的指针。
- *p是需要使用括号的；如果没有括号，编译器将认为p是指针数组，而不是指向数组的指针。

```c
int a[NUM_ROWS][NUM_COLS], (*p)[NUM_COLS], i;
...
for (p = &a[0]; p < &a[NUM_ROWS]; p++)
  (*p)[i] = 0;

/*
 * int []    整型数组
 * int *     整型指针
 * int *[]   整型指针数组
 * int (*)[] 整型数组指针
 * */
```

### 12.4.4 用多维数组名作为指针

```c
int a[NUM_ROWS][NUM_COLS];
```

- a不是指向a[0][0]的指针，而是指向a[0]的指针。
- 用作指针时，a的类型是int (*)[NUM_COLS]（指向长度为NUM_COLS的整型数组的指针）。

把数组a的第i列清零

```c
for (p = &a[0]; p < &a [NUM_ROWS]; p++)
  (*p)[i] = 0;
// 取代
for (p = a; p < a + NUM_ROWS; p++)
  (*p)[i] = 0;
```

另一种应用是巧妙地让函数把多维数组看成是一维数组。

```c
largest = find_largest(a[0], NUM_ROWS * NUM_COLS);
```

## 12.5 C99中的指针和变长数组

```c
void f(int n)
{
  int a[n], *p;
  p = a;
  ...
}
```

如果变长数组是多维的，指针的类型取决于除第一维外每一维的长度。

```c
void f(int m, int n)
{
  int a[m][n], (*p)[n];
  p = a;
  ...
}
```
