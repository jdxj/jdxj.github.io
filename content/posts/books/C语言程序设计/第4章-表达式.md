---
title: "第4章 表达式"
date: 2023-07-01T10:38:15+08:00
---

## 4.1 算术运算符

表4-1 算术运算符

![](https://res.weread.qq.com/wrepub/epub_31359737_100)

- 当把int型操作数和float型操作数混合在一起时，运算结果是float型的。
- 运算符%要求操作数是整数。如果两个操作数中有一个不是整数，程序将无法编译通过。
- 把零用作/或%的右操作数会导致未定义的行为
- 当运算符/和运算符%用于负操作数时，其结果难以确定。
  - 根据C89标准，如果两个操作数中有一个为负数，那么除法的结果既可以向上取整也可以向下取整。（例如，-9/7的结果既可以是-1也可以是-2。）
  - 在C89中，如果i或者j是负数，i%j的符号与具体实现有关。（例如，-9%7的值可能是-2或者5。）
  - 在C99中，除法的结果总是向零截取的（因此-9/7的结果是-1），i%j的值的符号与i的相同（因此-9%7的值是-2）。

### 运算符的优先级和结合性

![](https://res.weread.qq.com/wrepub/epub_31359737_1170)

## 4.2 赋值运算符

### 4.2.1 简单赋值

```c
i = 5;             /* i is now 5  */
j = i;             /* j is now 5  */
k = 10 * i + j;    /* k is now 55 */

int i;
float f;
i = 72.99f;        /* i is now 72 */
f = 136;           /* f is now 136.0 */
```

在许多编程语言中，赋值是语句；然而，**在C语言中，赋值就像+那样是运算符**。换句话说，赋值操作产生结果，这就如同两个数相加产生结果一样。

- 表达式`v = e`的值就是v的值
- =是右结合

```c
i = j = k = 0;

// 可能不是预期结果
int i;
float f;
f = i = 33.3f;

i = 1;
k = 1 + (j = i);
printf("%d %d %d\n", i, j, k);    /* prints "1 1 2" */
```

### 4.2.2 左值

左值表示存储在计算机内存中的对象，而不是常量或计算的结果。

- 赋值运算符要求它的左操作数必须是左值

### 4.2.3 复合赋值

```c
i += 2;   /* same as i = i + 2; */
```

是右结合的

## 4.3 自增运算符和自减运算符

```c
i = 1;
printf("i is %d\n", ++i);    /* prints "i is 2" */
printf("i is %d\n", i);      /* prints "i is 2" */

i = 1;
printf("i is %d\n", i++);    /* prints "i is 1" */
printf("i is %d\n", i);      /* prints "i is 2" */
```

后缀++和后缀--比一元的正号、负号优先级高，而且都是左结合的。前缀++和前缀--与一元的正号、负号优先级相同，而且都是右结合的。

## 4.4 表达式求值

表4-2 部分C语言运算符表

![](https://res.weread.qq.com/wrepub/epub_31359737_149)

### 子表达式的求值顺序

C语言没有定义子表达式的求值顺序（除了含有逻辑与运算符及逻辑或运算符（➤5.1节）、条件运算符（➤5.2节）以及逗号运算符（➤6.3节）的子表达式）。因
此，在表达式(a + b) * (c - d)中，无法确定子表达式(a + b)是否在子表达式(c - d)之前求值。

不管子表达式的计算顺序如何，大多数表达式都有相同的值。但是，当子表达式改变了某个操作数的值时，产生的值就可能不一致了。

- 第二条语句的执行结果是未定义的

```c
a = 5;
c = (b = a + 2) - (a = 1);
```

当程序中出现未定义的行为时，后果是不可预料的。

```c
c = (b = a + 2) - (a = 1);
j = i * i++;
```

## 4.5 表达式语句

C语言有一条不同寻常的规则，那就是任何表达式都可以用作语句。

- 通过在后面添加分号的方式将其转换成语句

```c
// 没有任何作用
i * j - 1;
```

在使用后缀形式的++或--时，何时执行自增或自减操作？

C语言标准引入了“顺序点”的概念，并且指出“应该在前一个顺序点和下一个顺序点之间对存储的操作数的值进行更新”。在C语言中有多种不同类型的顺序点，表
达式语句的末尾是其中一种。在表达式语句的末尾，该语句中的所有自增和自减操作都必须执行完毕，否则不能执行下一条语句。
