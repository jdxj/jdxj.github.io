---
title: "第13章 字符串"
date: 2023-07-05T14:56:43+08:00
---

## 13.1 字符串字面量

字符串字面量（string literal）是用一对双引号括起来的字符序列：

```c
"When you come to a fork in the road, take it."
```

### 13.1.1 字符串字面量中的转义序列

```c
"Candy\nIs dandy\nBut liquor\nIs quicker.\n  --Ogden Nash\n"
```

### 13.1.2 延续字符串字面量

```c
printf("When you come to a fork in the road, take it.   \
--Yogi Berra");
```

使用\有一个缺陷：字符串字面量必须从下一行的起始位置继续。因此，这就破坏了程序的缩进结构。

更好的方法

```c
printf("When you come to a fork in the road, take it. "
       "--Yogi Berra");
```

### 13.1.3 如何存储字符串字面量

- C语言把字符串字面量作为字符数组来处理。
- n个字符分配n+1个空间, 最后用\0标记字符串结束
- 空字符串: `""`(\0)

### 13.1.4 字符串字面量的操作

```c
char *p;
p = "abc";

char ch;
ch = "abc"[1];
```

试图改变字符串字面量会导致未定义的行为

```c
char *p = "abc";
*p = 'd';   /*** WRONG ***/
```

### 13.1.5 字符串字面量与字符常量

只包含一个字符的字符串字面量不同于字符常量。字符串字面量"a"是用指针来表示的，这个指针指向存放字符"a"（后面紧跟空字符）的内存单元。字符常量
'a'是用整数（字符集的数值码）来表示的。

## 13.2 字符串变量

```c
#define STR_LEN 80
...
char str[STR_LEN+1];
```

字符串的长度取决于空字符的位置

### 13.2.1 初始化字符串变量

```c
// 剩余空间编译器填充\0
char date1[8] = "June 14";
```

C语言允许初始化式（不包括空字符）与变量有完全相同的长度：

```c
char date3[7] = "June 14";
```

字符串变量的声明中可以省略它的长度。这种情况下，编译器会自动计算长度

```c
char date4[] = "June 14";
```

### 13.2.2 字符数组与字符指针

```c
char date[] = "June 14";
char *date = "June 14";
```

- 在声明为数组时，就像任意数组元素一样，可以修改存储在date中的字符。在声明为指针时，date指向字符串字面量，在13.1节我们已经看到字符串字面量
  是不可以修改的。
- 在声明为数组时，date是数组名。在声明为指针时，date是变量，这个变量可以在程序执行期间指向其他字符串。

在使用p作为字符串之前，必须把p指向字符数组

```c
char *p;
char str[STR_LEN+1], *p;
p = str;

// 使用未初始化的指针变量作为字符串是非常严重的错误。
char *p;
p[0] = 'a';   /*** WRONG ***/
p[1] = 'b';   /*** WRONG ***/
p[2] = 'c';   /*** WRONG ***/
p[3] = '\0';   /*** WRONG ***/
```

## 13.3 字符串的读和写

### 13.3.1 用printf函数和puts函数写字符串

```c
char str[] = "Are we having fun yet?";
printf("%s\n", str);
```

printf函数会逐个写字符串中的字符，直到遇到空字符才停止。

- 如果空字符丢失，printf函数会越过字符串的末尾继续写，直到最终在内存的某个地方找到空字符为止。

显示字符串的一部分

```c
// Are we
printf("%.6s\n", str);
```

转换说明%m.ps会使字符串的前p个字符在大小为m的字段内显示。

C函数库还提供了puts函数, puts函数总会添加一个额外的换行符

```c
puts(str);
```

### 13.3.2 用scanf函数和gets函数读字符串

调用时，scanf函数会跳过空白字符，然后读入字符并存储到str中，直到遇到空白字符为止。scanf函数始终会在字符串末尾存储一个空字符。

```c
scanf("%s", str);
```


为了一次读入一整行输入，可以使用gets函数。gets函数把读入的字符放到数组中，然后存储一个空字符。

- gets函数不会在开始读字符串之前跳过空白字符（scanf函数会跳过）。
- gets函数会持续读入直到找到换行符才停止（scanf函数会在任意空白字符处停止）。
- gets函数会忽略掉换行符，不会把它存储到数组中，用空字符代替换行符。

在把字符读入数组时，scanf函数和gets函数都无法检测数组何时被填满。

- scanf可以用%ns转换说明, 指定最多字符数
- gets没法指定限制
- fgets是更好的选择

### 13.3.3 逐个字符读字符串

```c
int read_line(char str[],  int n)
{
  int ch, i = 0;
  while ((ch = getchar()) != '\n')
    if (i < n)
      str[i++] = ch;
  str[i] = '\0';        /* terminates string */
  return i;             /* number of characters stored */
}
```

## 13.4 访问字符串中的字符

```c
int count_spaces(const char s[])
{
  int count = 0, i;
  for (i = 0; s[i] != '\0';  i++)
    if (s[i] == ' ')
      count++;
  return count;
}

// const阻止的是改变字符, 而不阻止改变s所指向的地址
int count_spaces(const char *s)
{
  int count = 0;
  for (; *s != '\0'; s++)
    if (*s == ' ')
      count++;
  return count;
}
```

## 13.5 使用C语言的字符串库

直接复制或比较字符串会失败。

```c
char str1[10], str2[10];
// 利用=运算符来把字符串复制到字符数组中是不可能的
str1 = "abc";     /*** WRONG ***/
str2 = str1;      /*** WRONG ***/
// 把数组名用作=的左操作数是非法的。但是，使用=初始化字符数组是合法的
// 因为在声明中=不是赋值运算符
char str1[10] = "abc";
// 使用关系运算符或判等运算符来比较字符串是合法的，但不会产生预期的结果
// 比较的是地址
if (str1 == str2) ...    /*** WRONG ***/
```

需要字符串操作的程序应该包含下列内容

```c
#include <string.h>
```

要注意那些没有声明为const的字符串形式参数。这些形式参数可能会在调用函数时发生改变，所以对应的实际参数不应该是字符串字面量。

### 13.5.1 strcpy函数

```c
char *strcpy(char *s1, const char *s2);
```

更安全的用法

```c
strncpy(str1, str2, sizeof(str1) - 1);
str1[sizeof(str1)-1] = '\0';
```
### 13.5.2 strlen函数

### 13.5.3 strcat函数

### 13.5.4 strcmp函数

## 13.6 字符串惯用法

## 13.7 字符串数组

```c
char planets[][8] = {"Mercury", "Venus", "Earth",
                     "Mars", "Jupiter", "Saturn",
                     "Uranus", "Neptune", "Pluto"};
// 不齐的数组
char *planets[] = {"Mercury", "Venus", "Earth",
                   "Mars", "Jupiter", "Saturn",
                   "Uranus", "Neptune", "Pluto"};
for (i = 0; i < 9;  i++)
  if (planets[i][0] == 'M')
    printf("%s begins with M\n", planets[i]);
```

### 命令行参数

为了能够访问这些命令行参数（C标准中称为程序参数），必须把main函数定义为含有两个参数的函数

```c
int main(int argc, char *argv[])
{
  ...
}
```

argc（“参数计数”）是命令行参数的数量（包括程序名本身），argv（“参数向量”）是指向命令行参数的指针数组，这些命令行参数以字符串的形式存储。

argv有一个附加元素，即argv[argc]，这个元素始终是一个空指针。空指针是一种不指向任何地方的特殊指针。NULL宏

![](https://res.weread.qq.com/wrepub/epub_31359737_567)

遍历参数

```c
int i;
for (i = 1; i < argc; i++)
  printf("%s\n", argv[i]);

char **p;
for (p = &argv[1]; *p != NULL; p++)
  printf("%s\n", *p);
```
