---
title: "8 固若金汤: 网站的安全架构"
date: 2023-07-24T15:27:20+08:00
---

## 8.1 道高一尺魔高一丈的网站应用攻击与防御

### 8.1.1 XSS攻击

XSS攻击即跨站点脚本攻击（Cross Site Script），指黑客通过篡改网页，注入恶意HTML脚本，在用户浏览网页时，控制用户浏览器进行恶意操作的一种攻击方
式。

常见的XSS攻击类型有两种

- 一种是反射型，攻击者诱使用户点击一个嵌入恶意脚本的链接，达到攻击的目的

图8.1 反射型XSS攻击

![](https://res.weread.qq.com/wrepub/epub_773202_87)

- 另外一种XSS攻击是持久型XSS攻击，黑客提交含有恶意脚本的请求，保存在被攻击的Web站点的数据库中，用户浏览网页时，恶意脚本被包含在正常页面中，达到
  攻击的目的

图8.2 持久型XSS攻击

![](https://res.weread.qq.com/wrepub/epub_773202_88)

主要防范手段

- 消毒. 即对某些html危险字符转义
- HttpOnly. 即浏览器禁止页面JavaScript访问带有HttpOnly属性的Cookie

### 8.1.2 注入攻击

图8.3 SQL注入攻击

![](https://res.weread.qq.com/wrepub/epub_773202_89)

SQL注入攻击需要攻击者对数据库结构有所了解才能进行，攻击者获取数据库表结构信息的手段有如下几种。

- 开源
- 错误回显
- 盲注

防御SQL注入攻击首先要避免被攻击者猜测到表名等数据库表结构信息，此外还可以采用如下方式

- 消毒. 过滤请求数据中可能注入的SQL
- 参数绑定. 使用预编译手段，绑定参数是最好的防SQL注入方法

除了SQL注入，攻击者还根据具体应用，注入OS命令、编程语言代码等，利用程序漏洞，达到攻击目的。

### 8.1.3 CSRF攻击

CSRF（Cross Site Request Forgery，跨站点请求伪造），攻击者通过跨站请求，以合法用户的身份进行非法操作

- 其核心是利用了浏览器Cookie或服务器Session策略，盗取用户身份。

图8.4 CSRF攻击

![](https://res.weread.qq.com/wrepub/epub_773202_90)

CSRF的防御手段主要是识别请求者身份

- 表单Token. CSRF是一个伪造用户请求的操作，所以需要构造用户请求的所有参数才可以。表单Token通过在请求参数中增加随机数的办法来阻止攻击者获得所有
  请求参数
- 验证码. 请求提交时，需要用户输入验证码，以避免在用户不知情的情况下被攻击者伪造请求。但是输入验证码是一个糟糕的用户体验，所以请在必要时使用
- Referer check. HTTP请求头的Referer域中记录着请求来源，可通过检查请求来源，验证其是否合法。很多网站使用这个功能实现图片防盗链

### 8.1.4 其他攻击和漏洞

**Error Code**

也称作错误回显，许多Web服务器默认是打开异常信息输出的，即服务器端未处理的异常堆栈信息会直接输出到客户端浏览器，这种方式虽然对程序调试和错误报告有
好处，但同时也给黑客造成可乘之机。

**HTML注释**

程序最终发布前需要进行代码review或自动扫描，避免HTML注释漏洞。

**文件上传**

如果上传的是可执行的程序，并通过该程序获得服务器端命令执行能力，那么攻击者几乎可以在服务器上为所欲为，并以此为跳板攻击集群环境的其他机器。最有效的
防御手段是设置上传文件白名单，只允许上传可靠的文件类型。此外还可以修改文件名、使用专门的存储等手段，保护服务器免受上传文件攻击。

**路径遍历**

攻击者在请求的URL中使用相对路径，遍历系统未开放的目录和文件。防御方法主要是将JS、CSS等资源文件部署在独立服务器、使用独立域名，其他文件不使用静态
URL访问，动态参数不包含文件路径信息。

### 8.1.5 Web应用防火墙

ModSecurity

图8.5 ModSecurity架构原理

![](https://res.weread.qq.com/wrepub/epub_773202_91)

### 8.1.6 网站安全漏洞扫描

网站安全漏洞扫描工具是根据内置规则，构造具有攻击性的URL请求，模拟黑客攻击行为，用以发现网站安全漏洞的工具。

## 8.2 信息加密技术及密钥安全管理

### 8.2.1 单向散列加密

图8.6 单向散列加密

![](https://res.weread.qq.com/wrepub/epub_773202_92)

### 8.2.2 对称加密

图8.8 对称加密

![](https://res.weread.qq.com/wrepub/epub_773202_94)

### 8.2.3 非对称加密

图8.9 非对称加密

![](https://res.weread.qq.com/wrepub/epub_773202_95)

### 8.2.4 密钥安全管理

一种方案是把密钥和算法放在一个独立的服务器上，甚至做成一个专用的硬件设施，对外提供加密和解密服务

另一种方案是将加解密算法放在应用系统中，密钥则放在独立服务器中，为了提高密钥的安全性，实际存储时，密钥被切分成数片，加密后分别保存在不同存储介质中

## 8.3 信息过滤与反垃圾

常用的信息过滤与反垃圾手段有以下几种

### 8.3.1 文本匹配

- 正则表达式匹配
- Trie树的变种
- 多级Hash表

还需要对信息做降噪预处理，然后再进行匹配

### 8.3.2 分类算法

- 贝叶斯分类算法

### 8.3.3 黑名单

## 8.4 电子商务风险控制

### 8.4.1 风险

- 账户风险：包括账户被黑客盗用，恶意注册账号等几种情形。
- 买家风险：买家恶意下单占用库存进行不正当竞争；黄牛利用促销抢购低价商品；此外还有良品拒收，欺诈退款及常见于B2B交易的虚假询盘等。
- 卖家风险：不良卖家进行恶意欺诈的行为，例如货不对板，虚假发货，炒作信用等，此外还有出售违禁商品、侵权产品等。
- 交易风险：信用卡盗刷，支付欺诈，洗钱套现等。

### 8.4.2 风控

机器自动风控的技术手段主要有规则引擎和统计模型。

**规则引擎**

当交易的某些指标满足一定条件时，就会被认为具有高风险的欺诈可能性。比如用户来自欺诈高发地区；交易金额超过某个数值；和上次登录的地址距离差距很大；用
户登录地与收货地不符；用户第一次交易等等。

规则引擎是一种将业务规则和规则处理逻辑相分离的技术

图8.14 基于规则引擎的风险控制系统

![](https://res.weread.qq.com/wrepub/epub_773202_100)

**统计模型**

规则引擎虽然技术简单，但是随着规则的逐渐增加，会出现规则冲突，难以维护等情况，而且规则越多，性能也越差。目前大型网站更倾向于使用统计模型进行风控。

风控领域使用的统计模型使用分类算法或者更复杂的机器学习算法进行智能统计。

图8.15 基于统计模型的风险控制系统

![](https://res.weread.qq.com/wrepub/epub_773202_101)

## 8.5 小结
