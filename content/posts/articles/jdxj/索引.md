---
title: "索引"
date: 2023-06-20T23:05:17+08:00
tags:
  - index
  - hash
---

索引有很多，哈希表、红黑树、B 树都可以在内存中使用，如果我们需要数据规模上亿后还能提供微秒级的访问速度，那么作为最快的索引，哈希表是第一选择。

![](https://static001.geekbang.org/resource/image/e5/c8/e5e07bd2abe9f0f15df1b43fdf25f9c8.jpg?wh=4431*4108)

不考虑范围查询与遍历操作，在追求最快速度的条件下，哈希表是最好的选择。

# 用哈希表有效地管理亿级数据

## 冲突

- 链接法虽然实现简单，还允许存放元素个数大于数组的大小（也叫装载因子大于 1），但链接法序列化数据的代价很大，因为使用了指针后，内存是不连续的。
- 开放寻址法确保所有对象都在数组里，就可以把数组用到的这段连续内存原地映射到文件中

## 如何序列化哈希表以外的数据

如果能将数据完整的放进数组，那么开放寻址法已经解决了序列化问题，所以我们应该选择开放寻址法。

但是，有两个因素使得我们必须把数据放在哈希桶之外：

- 每条数据有上百字节
- 哈希表中一定会有很多空桶（没有存放数据）。空桶的比例越高（装载因子越小），冲突概率也会越低，但如果每个空桶都占用上百字节，亿级规模会轻松把浪费的
  内存放大许多倍。

数据的长度是固定的

![](https://static001.geekbang.org/resource/image/7e/e8/7e0636fc6d9a70d6d4de07da678da6e8.jpg?wh=4488*1916)

数据的长度并不固定

![](https://static001.geekbang.org/resource/image/17/82/17f3f4e9e949a49a4ce7a50bbf1d4f82.jpg?wh=4562*2527)

## 降低哈希表的冲突概率

- 调优哈希函数
- 扩容

什么是好的哈希函数

- 计算量不能大
- 尽量降低冲突概率

当哈希函数把高信息量的关键字压缩成更小的数组下标时，一定会丢失信息。我们希望只丢失一些无关紧要的信息，尽量多地保留区分度高的信息。这需要分析关键字
的特点、分布规律。
