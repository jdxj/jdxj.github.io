---
title: "连接状态转换"
date: 2023-04-02T17:44:43+08:00
tags:
  - tcp
---

# 完整的状态转换

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/6/22/16b7c9fb02bff057~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

# 三次握手的状态变化

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/6/13/16b518cd1664fa5d~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

# 同时打开的状态变化

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/6/14/16b5693e5d32aef9~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

# 自连接的状态变化

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6bc5d724ec3b4a458f4ac546e0bf0f90~tplv-k3u1fbpfcp-zoom-in-crop-mark:3024:0:0:0.awebp?)

> 其实就是同时打开, 步骤5, 6在原文当中是window update包, 所以seq=1了.

# 四次挥手的状态变化

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/6/26/16b911c618264239~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

# 同时关闭的状态变化

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/9/28/16d75572508a08d2~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

> 同时关闭原文和图有点不一致(TIME-WAIT), 这里应该看文字.

- 最初客户端和服务端都处于 ESTABLISHED 状态
- 客户端发送 FIN 包，等待对端对这个 FIN 包的 ACK，随后进入 FIN-WAIT-1 状态
- 处于FIN-WAIT-1状态的客户端还没有等到 ACK，收到了服务端发过来的 FIN 包
- 收到 FIN 包以后客户端会发送对这个 FIN 包的的确认 ACK 包，同时自己进入 CLOSING 状态
- 继续等自己 FIN 包的 ACK
- 处于 CLOSING 状态的客户端终于等到了ACK，随后进入TIME-WAIT
- 在TIME-WAIT状态持续 2*MSL，进入CLOSED状态
