---
title: "Go Range到底复制了什么?"
date: 2023-11-21T11:55:42+08:00
tags:
  - go
---

[原文](https://gfw.go101.org/article/container.html#iteration:~:text=%E7%9A%84nil%E3%80%82-,%E9%81%8D%E5%8E%86%E5%AE%B9%E5%99%A8%E5%85%83%E7%B4%A0,-%E5%9C%A8Go%E4%B8%AD)

go 1.21及之前

```text
有两个重要的事实存在：
被遍历的容器值是aContainer的一个副本。 注意，只有aContainer的直接部分被复制了。 此副本是一个匿名的值，所以它是不可被修改的。
如果aContainer是一个数组，那么在遍历过程中对此数组元素的修改不会体现到循环变量中。 原因是此数组的副本（被真正遍历的容器）和此数组不共享任何元素。
如果aContainer是一个切片（或者映射），那么在遍历过程中对此切片（或者映射）元素的修改将体现到循环变量中。 原因是此切片（或者映射）的副本和此切片（或者映射）共享元素（或条目）。
在遍历中的每个循环步，aContainer副本中的一个键值元素对将被赋值（复制）给循环变量。 所以对循环变量的直接部分的修改将不会体现在aContainer中的对应元素中。 （因为这个原因，并且for-range循环是遍历映射条目的唯一途径，所以最好不要使用大尺寸的映射键值和元素类型，以避免较大的复制负担。）
```

go 1.22

```text
从Go 1.22版本开始，每组键值元素对将被赋值给一对与众不同的循环变量实例（既循环变量在每个循环步都会生成一份新的实例）。
```