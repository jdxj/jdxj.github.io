---
title: "文本模式下控制显卡"
date: 2023-08-29T12:08:32+08:00
tags:
  - x86
  - asm
---

# 光标寄存器

打印字符超过一行时, 显卡不会自动换行, 需要程序控制光标

两个光标寄存器组成16位, 存储了光标位置 = 80*i+j (0<=i<=24, 0<=j<=79)

1. 指定光标寄存器. 访问显卡中的寄存器需要通过数据端口0x3d4指定要访问哪个寄存器

光标寄存器编号

- 14(0x0e), 高8位
- 15(0x0f), 低8位

2. 读写数据. 通过数据端口0x3d5来进行

打印字符流程

![](https://res.weread.qq.com/wrepub/CB_3300050845_txt011_80.jpg)

```nasm
; 取当前光标位置
mov dx,0x3d4
mov al,0x0e
out dx,al
mov dx,0x3d5
in  al,dx                        ;高8位 
mov ah,al

mov dx,0x3d4
mov al,0x0f
out dx,al
mov dx,0x3d5
in al,dx                        ;低8位
```

# 显存地址

向映射到内存空间的显存地址写入ascii就能打印字符

显存地址为0xb800, 每两个字节显示一个字符, 低字节存储ascii, 高字节存储属性.

光标位置*2可以得到某字符在内存中的偏移
