---
title: "8086的内存分段机制"
date: 2023-08-21T12:54:01+08:00
tags:
  - x86
---

分段机制能解决程序重定位问题.

![](https://res.weread.qq.com/wrepub/CB_3300050845_txt004_8.jpg)

- 在进行数据传送或者算术逻辑运算的时候，使用算术逻辑部件(ALU)。比如，将AX的内容和CX的内容相加，结果仍在AX中，那么，在相加的结果返回到AX之前，
  需要通过一个叫数据暂存器的寄存器中转。
- 处理器能够自动运行，这是控制器的功劳。为了加快指令执行速度，8086内部有一个6字节的指令预取队列，在处理器忙着执行那些不需要访问内存的指令时，
  指令预取部件可以趁机访问内存预取指令。这时，多达6字节的指令流可以排队等待解码和执行。
- 8086内部有4个段寄存器。其中，CS是代码段寄存器，DS是数据段寄存器，ES是附加段(Extra Segment)寄存器。附加段的意思是，它是额外赠送的礼物，
  当需要在程序中同时使用两个数据段时，DS指向一个，ES指向另一个。可以在指令中指定使用DS和ES中的哪一个，如果没有指定，则默认使用DS。SS是栈段(Stack Segment)寄存器
- IP是指令指针(Instruction Pointer)寄存器，它只和CS一起使用，而且只有处理器才能直接改变它的内容。当一段代码开始执行时，CS保存代码段的段
  地址，IP则指向段内偏移。这样，由CS和IP共同形成逻辑地址，并由总线接口部件变换成物理地址来取得指令。然后，处理器会自动根据当前指令的长度来改
  变IP的值，使它指向下一条指令。

8086地址线20位, 而段寄存器16位, 由于段寄存器长度的限制，段不能起始于任意位置，也不是所有内存地址都可以作为段地址，段只能起始于那些能够被16
整除的物理内存地址。

- 即段寄存器只存地址前16位, 且只存后4位是0的地址
- 8086处理器在形成物理地址时，先将段寄存器的内容乘以16或者左移4位，形成20位的段地址，然后再同16位的偏移地址相加，得到20位的物理地址。